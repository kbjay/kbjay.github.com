<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  

  
  <title>kb_jay的开发站台</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta property="og:type" content="website">
<meta property="og:title" content="kb_jay的开发站台">
<meta property="og:url" content="http://yoursite.com/index.html">
<meta property="og:site_name" content="kb_jay的开发站台">
<meta property="og:locale" content="default">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="kb_jay的开发站台">
  
    <link rel="alternate" href="/atom.xml" title="kb_jay的开发站台" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  <link rel="stylesheet" href="/css/style.css">
</head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">kb_jay的开发站台</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://yoursite.com"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main">
  
    <article id="post-kotlin-基础" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2020/06/09/kotlin-基础/" class="article-date">
  <time datetime="2020-06-09T09:14:27.000Z" itemprop="datePublished">2020-06-09</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2020/06/09/kotlin-基础/">kotlin基础</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h4 id="基础入门"><a href="#基础入门" class="headerlink" title="基础入门"></a>基础入门</h4><h5 id="声明变量"><a href="#声明变量" class="headerlink" title="声明变量"></a>声明变量</h5><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">val</span> a :String = <span class="string">"hello"</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">val</span> b = <span class="number">2</span></span><br></pre></td></tr></table></figure>
<ol>
<li><p>val：只读； var：可读写</p>
</li>
<li><p>自动类型推导</p>
</li>
</ol>
<h5 id="Long标记"><a href="#Long标记" class="headerlink" title="Long标记"></a>Long标记</h5><p>必须大写L</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">val</span> a = <span class="number">222</span>L</span><br></pre></td></tr></table></figure>
<h5 id="类型转换"><a href="#类型转换" class="headerlink" title="类型转换"></a>类型转换</h5><p>int转long不能直接转（跟java不同）</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">val</span> a = <span class="number">2</span></span><br><span class="line"><span class="keyword">val</span> b :<span class="built_in">Long</span> = a <span class="comment">// error</span></span><br><span class="line"><span class="keyword">val</span> b :<span class="built_in">Long</span> = a.toLong() <span class="comment">//ok</span></span><br></pre></td></tr></table></figure>
<h5 id="无符号类型"><a href="#无符号类型" class="headerlink" title="无符号类型"></a>无符号类型</h5><p>java没有</p>
<p>UInt ，UShort，ULong</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">val</span> a = <span class="number">1</span>u</span><br><span class="line"></span><br><span class="line"><span class="keyword">val</span> b = <span class="number">10000000000</span>u</span><br></pre></td></tr></table></figure>
<h5 id="String"><a href="#String" class="headerlink" title="String"></a>String</h5><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">val</span> content = <span class="string">"hello kotlin"</span></span><br><span class="line"><span class="keyword">val</span> html = <span class="string">"""</span></span><br><span class="line"><span class="string">            &lt;html&gt;</span></span><br><span class="line"><span class="string">                &lt;title&gt;</span></span><br><span class="line"><span class="string">                &lt;/title&gt;</span></span><br><span class="line"><span class="string">                &lt;body&gt;</span></span><br><span class="line"><span class="string">                    &lt;div&gt; <span class="variable">$content</span> &lt;/div&gt;</span></span><br><span class="line"><span class="string">                &lt;/body&gt;</span></span><br><span class="line"><span class="string">            &lt;/html&gt;</span></span><br><span class="line"><span class="string">            """</span>.trimIndent()</span><br></pre></td></tr></table></figure>
<ul>
<li>Kotlin 中 “==”比较的是内容，“===” 比较的是引用 </li>
<li>字符串拼接可以使用“$”</li>
<li>格式化string，如上所示，trimIndent()方法的作用是去掉公共的缩进</li>
</ul>
<h5 id="数组"><a href="#数组" class="headerlink" title="数组"></a>数组</h5><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* 定义</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">val</span> a = intArrayOf(<span class="number">1</span>, <span class="number">2</span>)</span><br><span class="line"><span class="keyword">val</span> b = IntArray(<span class="number">2</span>) &#123; it + <span class="number">1</span> &#125;</span><br><span class="line">print(b.contentToString())</span><br><span class="line">print(a.size)</span><br><span class="line"></span><br><span class="line"><span class="keyword">val</span> c = arrayOf(<span class="string">"hello"</span>, <span class="string">"kotlin"</span>)</span><br><span class="line">c[<span class="number">1</span>] = <span class="string">"world"</span></span><br><span class="line">println(<span class="string">"<span class="subst">$&#123;c[<span class="number">0</span>]&#125;</span>,<span class="subst">$&#123;c[<span class="number">1</span>]&#125;</span>"</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* 遍历</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">val</span> d = floatArrayOf(<span class="number">1</span>f, <span class="number">2</span>f)</span><br><span class="line"><span class="keyword">for</span> (item <span class="keyword">in</span> d) &#123;</span><br><span class="line">  print(item)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">d.forEach &#123; item -&gt;</span><br><span class="line">           print(item)</span><br><span class="line">          &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//带下标</span></span><br><span class="line"><span class="keyword">for</span> (i <span class="keyword">in</span> a.indices)&#123;</span><br><span class="line">  print(<span class="string">"<span class="variable">$i</span> ,<span class="subst">$&#123;a[i]&#125;</span>"</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* 判断元素是否存在</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">if</span> (<span class="number">1</span>f <span class="keyword">in</span> d) &#123;</span><br><span class="line">  print(<span class="string">"exist"</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="number">3</span>f !<span class="keyword">in</span> d) &#123;</span><br><span class="line">  print(<span class="string">"not exist"</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="区间"><a href="#区间" class="headerlink" title="区间"></a>区间</h5><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* 定义</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">val</span> a = <span class="number">1.</span><span class="number">.10</span> <span class="comment">//[1,10]</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">val</span> b = <span class="number">1</span> until <span class="number">10</span> <span class="comment">//[1,10)</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">val</span> c = <span class="number">10</span> downTo <span class="number">1</span> <span class="comment">//[10,1]</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">val</span> d = <span class="number">1.</span><span class="number">.10</span> step <span class="number">2</span> <span class="comment">//[1,3,5,6,9]</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">val</span> e = <span class="number">1.0</span>.<span class="number">.2</span><span class="number">.0</span> <span class="comment">//连续的，DoubleRange</span></span><br><span class="line"></span><br><span class="line">print(a.joinToString())</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* 判断是否存在</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">if</span> (<span class="number">1.1</span> <span class="keyword">in</span> e) &#123;</span><br><span class="line">  print(<span class="string">"exist"</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* 遍历</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">for</span> (i <span class="keyword">in</span> a) &#123;</span><br><span class="line">  print(i)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="集合框架"><a href="#集合框架" class="headerlink" title="集合框架"></a>集合框架</h5><ul>
<li><p>增加了不可变的集合</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 定义</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">val</span> listOf = listOf(<span class="number">1</span>, <span class="number">23</span>) <span class="comment">//不可变</span></span><br><span class="line"><span class="keyword">val</span> mutableListOf = mutableListOf&lt;<span class="built_in">Int</span>&gt;()</span><br><span class="line"></span><br><span class="line"><span class="keyword">val</span> mapOf = mapOf(<span class="string">"name"</span> to <span class="string">"wzq"</span>, <span class="string">"age"</span> to <span class="number">18</span>)</span><br><span class="line"><span class="keyword">val</span> mutableMapOf = mutableMapOf(<span class="string">"name"</span> to <span class="string">"wzq"</span>, <span class="string">"age"</span> to <span class="number">18</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 添加</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">mutableListOf.add(<span class="number">3</span>)</span><br><span class="line">mutableListOf += <span class="number">4</span></span><br><span class="line">mutableListOf -= <span class="number">4</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 访问</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">listOf[<span class="number">0</span>]</span><br><span class="line"></span><br><span class="line">mapOf[<span class="string">"name"</span>]</span><br><span class="line">mapOf.<span class="keyword">get</span>(<span class="string">"age"</span>)</span><br></pre></td></tr></table></figure>
</li>
<li><p>增加了一些语法糖 filter，map等</p>
</li>
<li><p>基于Java，类型别名typealias，给java中的java.util.ArrayList在kotlin中起了一个别名ArrayList</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">typealias ArrayList&lt;E&gt; = java.util.ArrayList&lt;E&gt;</span><br><span class="line">typealias LinkedHashMap&lt;K, V&gt; = java.util.LinkedHashMap&lt;K, V&gt;</span><br><span class="line">typealias HashMap&lt;K, V&gt; = java.util.HashMap&lt;K, V&gt;</span><br><span class="line">typealias LinkedHashSet&lt;E&gt; = java.util.LinkedHashSet&lt;E&gt;</span><br><span class="line">typealias HashSet&lt;E&gt; = java.util.HashSet&lt;E&gt;</span><br></pre></td></tr></table></figure>
</li>
<li><p>新类型</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 新类型pair</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">val</span> pair = <span class="string">"key"</span> to <span class="string">"value"</span></span><br><span class="line"><span class="keyword">val</span> pair1 = Pair(<span class="string">"key"</span>, <span class="string">"value"</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">//读取内容</span></span><br><span class="line">pair.first</span><br><span class="line">pair.second</span><br><span class="line"><span class="keyword">val</span> (x, y) = pair <span class="comment">//解构表达式</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> *  新类型triple</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">val</span> tt = Triple(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>)</span><br><span class="line"><span class="keyword">val</span> (m, n, z) = tt  <span class="comment">//解构表达式</span></span><br><span class="line">tt.first</span><br><span class="line">tt.second</span><br><span class="line">tt.third</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h5 id="函数基本概念"><a href="#函数基本概念" class="headerlink" title="函数基本概念"></a>函数基本概念</h5><p>kotlin的函数有自己的类型，所以是“一等公民”。可以赋值，传递并在合适的条件下调用。</p>
<ul>
<li><p>方法跟函数（概念性）</p>
</li>
<li><p>定义在类中的函数是方法</p>
</li>
<li><p>函数类型，函数引用</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 类型 ()-&gt;Unit</span></span><br><span class="line"><span class="comment">// 引用	::foo</span></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">foo</span><span class="params">()</span></span>&#123;&#125;  </span><br><span class="line"></span><br><span class="line"><span class="comment">// (String)-&gt;Int</span></span><br><span class="line"><span class="comment">// ::foo</span></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">foo</span><span class="params">(str:<span class="type">String</span>)</span></span>:<span class="built_in">Int</span>&#123;&#125;   </span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Foo</span></span>&#123;</span><br><span class="line">  <span class="comment">// Foo.(String)-&gt;Long     (Foo,String)-&gt;Long</span></span><br><span class="line">  <span class="comment">// Foo::bar</span></span><br><span class="line">  <span class="function"><span class="keyword">fun</span> <span class="title">bar</span><span class="params">(str: <span class="type">String</span>)</span></span>:<span class="built_in">Long</span>&#123;&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">val</span> f: ()-&gt;<span class="built_in">Unit</span> = ::foo</span><br><span class="line"><span class="keyword">val</span> h: (Foo,String)-&gt;<span class="built_in">Long</span> = Foo::bar</span><br><span class="line"></span><br><span class="line"><span class="keyword">val</span> foo = Foo()</span><br><span class="line"><span class="keyword">val</span> a: (String)-&gt;<span class="built_in">Long</span> = foo::bar</span><br><span class="line"></span><br><span class="line"><span class="comment">//通过引用调用</span></span><br><span class="line">a.invoke(<span class="string">"wzq"</span>)</span><br><span class="line"><span class="comment">//或者</span></span><br><span class="line">a(<span class="string">"wzq"</span>)</span><br></pre></td></tr></table></figure>
</li>
</ul>
<ul>
<li><p>参数：变长，默认，具名</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* 变长参数</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">mutiParams</span><span class="params">(<span class="keyword">vararg</span> mutiParam: <span class="type">Int</span>)</span></span>: <span class="built_in">Int</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> mutiParam.sum()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* 默认参数</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">defaltParams</span><span class="params">(name: <span class="type">String</span>, type: <span class="type">Int</span> = <span class="number">1</span>)</span></span> &#123;</span><br><span class="line">  print(<span class="string">"<span class="variable">$name</span>,<span class="variable">$type</span>"</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">test</span><span class="params">()</span></span> &#123;</span><br><span class="line">  defaltParams(<span class="string">"wzq"</span>)</span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">  * 具名参数</span></span><br><span class="line"><span class="comment">  */</span></span><br><span class="line">  defaltParams(name = <span class="string">"zpy"</span>, type = <span class="number">2</span>)</span><br><span class="line">  print(mutiParams(<span class="number">1</span>, <span class="number">2</span>))</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>多返回值（借助Pair，Triple）</p>
</li>
</ul>
<h5 id="类和接口"><a href="#类和接口" class="headerlink" title="类和接口"></a>类和接口</h5><ol>
<li><p>kotlin中默认都是public的</p>
</li>
<li><p>kotlin中类的成员变量必须初始化（在构造器中完成初始化，或者定义的时候直接赋值）</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//默认是public的  </span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">SimpleClass</span> </span>&#123;</span><br><span class="line">   		<span class="comment">/**</span></span><br><span class="line"><span class="comment">   		* 这里不用初始化是因为在构造器中完成了</span></span><br><span class="line"><span class="comment">   		**/</span></span><br><span class="line">       <span class="keyword">private</span> <span class="keyword">var</span> x: <span class="built_in">Int</span></span><br><span class="line">     	<span class="comment">/**</span></span><br><span class="line"><span class="comment">     	* 这里的y必须初始化，kotlin强调类必须对自己的成员变量负责。</span></span><br><span class="line"><span class="comment">     	**/</span></span><br><span class="line">       <span class="keyword">private</span> <span class="keyword">var</span> y: <span class="built_in">Int</span> = <span class="number">0</span></span><br><span class="line">     	<span class="comment">/**</span></span><br><span class="line"><span class="comment">     	* 构造器方式（副构造器）</span></span><br><span class="line"><span class="comment">     	**/</span></span><br><span class="line">       <span class="keyword">constructor</span>(x: <span class="built_in">Int</span>) &#123;</span><br><span class="line">           <span class="keyword">this</span>.x = x</span><br><span class="line">     &#125;</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>构造器，分为主构造器跟副构造器。新建类实例的路径必须经过主构造器（如果有的话）</p>
<p>以上类从副构造器转为主构造器如下：</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* 主构造器</span></span><br><span class="line"><span class="comment">**/</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">SimpleClass</span></span>(<span class="keyword">private</span> <span class="keyword">var</span> x: <span class="built_in">Int</span>) &#123;</span><br><span class="line"><span class="keyword">private</span> <span class="keyword">var</span> y: <span class="built_in">Int</span> = <span class="number">0</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>在kotlin定义一个属性 = get方法+set方法+属相</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">SimpleClass</span></span>(x: <span class="built_in">Int</span>) &#123;</span><br><span class="line">    <span class="keyword">var</span> x = x</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 以下默认生成，需要自定义的话可以改成自己的逻辑</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">    <span class="keyword">get</span>() &#123;</span><br><span class="line">        <span class="keyword">return</span> field <span class="comment">//backing field</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">set</span>(value) &#123;</span><br><span class="line">        field = value</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">test</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">val</span> simpleClass = SimpleClass(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">    * 属相引用</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">    <span class="keyword">val</span> kProperty1 = simpleClass::x</span><br><span class="line">    kProperty1.<span class="keyword">set</span>(<span class="number">2</span>)</span><br><span class="line">    print(kProperty1.<span class="keyword">get</span>())</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>类中的方法默认都是final的，如果子类想要重写，那么需要在类的方法前面加open关键字</p>
</li>
<li><p>接口中可以定义属性</p>
</li>
<li><p>继承类跟接口使用“:”，类的话需要带主构造，具体如下：</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">AbstractClass</span> </span>&#123;</span><br><span class="line"> <span class="keyword">abstract</span> <span class="function"><span class="keyword">fun</span> <span class="title">xxx</span><span class="params">()</span></span></span><br><span class="line"> <span class="keyword">open</span> <span class="function"><span class="keyword">fun</span> <span class="title">canReWrite</span><span class="params">()</span></span> &#123;&#125;</span><br><span class="line">    </span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">  * 没有open子类不能重写</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">    <span class="function"><span class="keyword">fun</span> <span class="title">cannotReWrite</span><span class="params">()</span></span> &#123;&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">interface</span> <span class="title">Interface</span> </span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">fun</span> <span class="title">yyy</span><span class="params">()</span></span></span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">  * 接口可以定义属相</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">    <span class="keyword">val</span> y: <span class="built_in">Int</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">SimpleClass</span></span>(<span class="keyword">private</span> <span class="keyword">val</span> x: <span class="built_in">Int</span>) : AbstractClass(), Interface &#123;</span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">  * 实现接口定义的属相y</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">    <span class="keyword">override</span> <span class="keyword">val</span> y: <span class="built_in">Int</span></span><br><span class="line">    <span class="keyword">get</span>() = TODO(<span class="string">"Not yet implemented"</span>)</span><br><span class="line"></span><br><span class="line">  <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">yyy</span><span class="params">()</span></span> &#123;</span><br><span class="line">	  TODO(<span class="string">"Not yet implemented"</span>)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">xxx</span><span class="params">()</span></span> &#123;</span><br><span class="line">	  TODO(<span class="string">"Not yet implemented"</span>)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">canReWrite</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">super</span>.canReWrite()</span><br><span class="line">    print(<span class="string">"xxx"</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ol>
<h5 id="空安全类型-amp-平台类型"><a href="#空安全类型-amp-平台类型" class="headerlink" title="空安全类型&amp;平台类型"></a>空安全类型&amp;平台类型</h5><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">test</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * a不可为null</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">var</span> a: String = <span class="string">""</span></span><br><span class="line">      <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * b可以为null</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">var</span> b: String? = <span class="string">""</span></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 报错</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    b.length</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 安全访问 ?.</span></span><br><span class="line"><span class="comment">     * ?:  如果b为null那么b?.length 返回null，使用?:可以设置默认值</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">val</span> length = b?.length ?: <span class="number">0</span></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 强转 !!  如果确认b不为null，那么可以强转</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    b!!.length</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 平台类型 String! ：调用java中的方法返回java的String时，类型为String!,这时需要我们自己去判断是否				为空</span></span><br><span class="line"><span class="comment">     * 我们无法自己创建</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * 如下返回的类型是 TimeZone！</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">val</span> <span class="keyword">default</span> = TimeZone.getDefault()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="扩展方法-amp-属相"><a href="#扩展方法-amp-属相" class="headerlink" title="扩展方法&amp;属相"></a>扩展方法&amp;属相</h5><p>kotlin支持在不修改类代码的情况下，动态为类添加属性（扩展属性）和方法（扩展方法）</p>
<ul>
<li><p>扩展方法定义</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">StringUtils</span> </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> name: String = <span class="string">"StringUtils"</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">fun</span> StringUtils.<span class="title">CustomGetLenth</span><span class="params">()</span></span>: <span class="built_in">Int</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">this</span>.name.length</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">main</span><span class="params">(args: <span class="type">Array</span>&lt;<span class="type">String</span>&gt;)</span></span> &#123;</span><br><span class="line">    <span class="keyword">val</span> lenth = StringUtils().CustomGetLenth()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>扩展方法本质</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">StringUtilsKt</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> <span class="title">CustomGetLenth</span><span class="params">(@NotNull StringUtils $receiver)</span></span></span><br><span class="line"><span class="function">  </span>&#123;</span><br><span class="line">    Intrinsics.checkParameterIsNotNull($receiver, <span class="string">"receiver$0"</span>);<span class="keyword">return</span> 			$receiver.getName().length();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>如果父类和子类都扩展了同名的一个扩展方法，引用类型均为父类的情况下，会调用父类的扩展方法。</strong></p>
</li>
<li><p>扩展属相没有backing field，（接口中的属相也没有）</p>
</li>
<li><p>参考：<a href="https://www.cnblogs.com/nicolas2019/p/10932131.html" target="_blank" rel="noopener">https://www.cnblogs.com/nicolas2019/p/10932131.html</a></p>
</li>
</ul>
<h5 id="智能类型转换"><a href="#智能类型转换" class="headerlink" title="智能类型转换"></a>智能类型转换</h5><ul>
<li><p>a  as  B</p>
</li>
<li><p>a  as?  B (失败返回null)</p>
</li>
<li><p>a is B </p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">open</span> <span class="class"><span class="keyword">class</span> <span class="title">Parent</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Son</span></span>(<span class="keyword">val</span> name: String) : Parent() &#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">test</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">val</span> x: Parent = Son(<span class="string">"wzq"</span>)</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * x is Son 之后，如果返回true，那么x就已经强转完成了</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">if</span> (x <span class="keyword">is</span> Son) &#123;</span><br><span class="line">        print(x.name)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h5 id="if，when，try-catch-是表达式"><a href="#if，when，try-catch-是表达式" class="headerlink" title="if，when，try catch 是表达式"></a>if，when，try catch 是表达式</h5><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> b: <span class="built_in">Boolean</span> = <span class="literal">false</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> a = <span class="keyword">if</span> (b) <span class="number">1</span> <span class="keyword">else</span> <span class="number">2</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> c = <span class="keyword">when</span> (b) &#123;</span><br><span class="line">  <span class="literal">true</span> -&gt; <span class="number">1</span></span><br><span class="line">  <span class="literal">false</span> -&gt; <span class="number">2</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> d = <span class="keyword">when</span> &#123;</span><br><span class="line">  b -&gt; <span class="number">1</span></span><br><span class="line">  <span class="keyword">else</span> -&gt; <span class="number">2</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> e = <span class="keyword">try</span> &#123;</span><br><span class="line">  <span class="comment">//xxx</span></span><br><span class="line">  <span class="number">1</span></span><br><span class="line">&#125; <span class="keyword">catch</span> (e: Exception) &#123;</span><br><span class="line">  <span class="number">2</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="LAMBDA-表达式"><a href="#LAMBDA-表达式" class="headerlink" title="LAMBDA 表达式"></a>LAMBDA 表达式</h5><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">name</span><span class="params">()</span></span> &#123;</span><br><span class="line">    print(<span class="string">"xxx"</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 匿名函数(去掉名字)</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">val</span> func = <span class="function"><span class="title">fun</span><span class="params">()</span></span> &#123;</span><br><span class="line">    print(<span class="string">"xxx"</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * lambda是一种特殊的匿名函数</span></span><br><span class="line"><span class="comment"> * () -&gt; Unit</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">val</span> func1 = &#123;</span><br><span class="line">    print(<span class="string">"xxx"</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * (Int,String) -&gt; String</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">val</span> func2 = &#123; p: <span class="built_in">Int</span>, p1: String -&gt;</span><br><span class="line">    print(<span class="string">"<span class="variable">$p1</span>,<span class="variable">$p</span>"</span>)</span><br><span class="line">    p1</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 如果只有一个参数的话用it就行</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">val</span> func3: (<span class="built_in">Int</span>) -&gt; <span class="built_in">Unit</span> = &#123;</span><br><span class="line">    print(<span class="string">"<span class="variable">$it</span>"</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * IntArray接收一个lambda表达式（只有一个参数）用来初始化数组</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    IntArray(<span class="number">5</span>, &#123; it &#125;)</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 另一种格式,简化版</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    IntArray(<span class="number">5</span>) &#123; it &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="amp-hashcode"><a href="#amp-hashcode" class="headerlink" title="== &amp; hashcode"></a>== &amp; hashcode</h5><p>版本1:</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Person</span></span>(<span class="keyword">var</span> name: String, <span class="keyword">var</span> age: <span class="built_in">Int</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">val</span> hashSet = HashSet&lt;Person&gt;()</span><br><span class="line">    (<span class="number">0.</span><span class="number">.5</span>).forEach &#123;</span><br><span class="line">        hashSet += Person(<span class="string">"wzq"</span>, <span class="number">18</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 输出6</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    print(hashSet.size)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>版本2:</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Person</span></span>(<span class="keyword">var</span> name: String, <span class="keyword">var</span> age: <span class="built_in">Int</span>) &#123;</span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">equals</span><span class="params">(other: <span class="type">Any</span>?)</span></span>: <span class="built_in">Boolean</span> &#123;</span><br><span class="line">        <span class="keyword">val</span> person = other <span class="keyword">as</span>? Person ?: <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">        <span class="keyword">return</span> person.age == age &amp;&amp; person.name == name</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">hashCode</span><span class="params">()</span></span>: <span class="built_in">Int</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> age + name.hashCode()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">val</span> hashSet = HashSet&lt;Person&gt;()</span><br><span class="line">    (<span class="number">0.</span><span class="number">.5</span>).forEach &#123;</span><br><span class="line">        hashSet += Person(<span class="string">"wzq"</span>, <span class="number">18</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 输出1</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    print(hashSet.size)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>版本3:</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">val</span> hashSet = HashSet&lt;Person&gt;()</span><br><span class="line">    <span class="keyword">val</span> person = Person(<span class="string">"wzq"</span>, <span class="number">18</span>)</span><br><span class="line">    hashSet += person</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 输出1</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    print(hashSet.size)</span><br><span class="line">    person.name = <span class="string">"zpy"</span></span><br><span class="line">    hashSet -= person</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 输出1</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    print(hashSet.size)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>把Person的name跟age改为 val之后可以避免这种错误，因为val不允许修改</p>
<p>版本4:</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Person</span></span>(<span class="keyword">val</span> name: String, <span class="keyword">val</span> age: <span class="built_in">Int</span>) &#123;</span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">equals</span><span class="params">(other: <span class="type">Any</span>?)</span></span>: <span class="built_in">Boolean</span> &#123;</span><br><span class="line">        <span class="keyword">val</span> person = other <span class="keyword">as</span>? Person ?: <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">        <span class="keyword">return</span> person.age == age &amp;&amp; person.name == name</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">hashCode</span><span class="params">()</span></span>: <span class="built_in">Int</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> age + name.hashCode()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="函数进阶"><a href="#函数进阶" class="headerlink" title="函数进阶"></a>函数进阶</h4><h5 id="高阶函数"><a href="#高阶函数" class="headerlink" title="高阶函数"></a>高阶函数</h5><ul>
<li><p>概念：参数是函数或者返回值是函数的函数</p>
</li>
<li><p>例子：</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// IntArray的构造方法</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">inline</span> <span class="keyword">constructor</span>(size: <span class="built_in">Int</span>, init: (<span class="built_in">Int</span>) -&gt; <span class="built_in">Int</span>)</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h5 id="内联函数"><a href="#内联函数" class="headerlink" title="内联函数"></a>内联函数</h5><ul>
<li><p>概念：在程序编译时能将程序中内联函数的调用表达式直接替换成内联函数的函数体。</p>
</li>
<li><p>例子：</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">doSomething</span><span class="params">(m: ()</span></span> -&gt; <span class="built_in">Unit</span>) &#123;</span><br><span class="line">    print(<span class="string">"doSomething start"</span>)</span><br><span class="line">    m()</span><br><span class="line">    print(<span class="string">"doSomething end"</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    print(<span class="string">"main start"</span>)</span><br><span class="line">    doSomething &#123; print(<span class="string">"lambda"</span>) &#125;</span><br><span class="line">    print(<span class="string">"main end"</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>转为java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  String var0 = <span class="string">"main start"</span>;</span><br><span class="line">  System.out.print(var0);</span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">  * 1. 调用了doSomething方法，2. new了一个Function0的实例</span></span><br><span class="line"><span class="comment">  **/</span></span><br><span class="line">  doSomething((Function0)<span class="keyword">null</span>.INSTANCE);</span><br><span class="line">  var0 = <span class="string">"main end"</span>;</span><br><span class="line">  System.out.print(var0);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>doSomething添加inline之后转为java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  String var0 = <span class="string">"main start"</span>;</span><br><span class="line">  System.out.print(var0);</span><br><span class="line">      <span class="comment">// 第一次内联：少了doSomething的调用</span></span><br><span class="line">      String var7 = <span class="string">"doSomething start"</span>;</span><br><span class="line">      System.out.print(var7);</span><br><span class="line">          <span class="comment">// 第二次内联，少了lambda函数的调用</span></span><br><span class="line">          String var4 = <span class="string">"lambda"</span>;</span><br><span class="line">          System.out.print(var4);</span><br><span class="line">      var7 = <span class="string">"doSomething end"</span>;</span><br><span class="line">      System.out.print(var7);</span><br><span class="line">  var0 = <span class="string">"main end"</span>;</span><br><span class="line">  System.out.print(var0);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>相比较</p>
<ol>
<li>少了新建实例的开销</li>
<li>少了方法调用（进出方法栈）的开销，一个是doSomething方法的调用，一个是lambda函数的调用</li>
</ol>
</li>
<li><p>高阶函数跟内联函数更配</p>
</li>
<li><p>内联函数的局部return跟非局部return</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    intArrayOf(<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>).forEach &#123;</span><br><span class="line">        <span class="keyword">if</span>(it == <span class="number">2</span>)</span><br><span class="line">      			<span class="comment">/**</span></span><br><span class="line"><span class="comment">             * 局部return，这里相当于continue</span></span><br><span class="line"><span class="comment">             */</span></span><br><span class="line">            <span class="keyword">return</span><span class="symbol">@forEach</span></span><br><span class="line">        println(it)</span><br><span class="line">    &#125;</span><br><span class="line">    println(<span class="string">"bbb"</span>)</span><br><span class="line">    <span class="keyword">return</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 打印结果</span></span><br><span class="line"><span class="number">1</span></span><br><span class="line"><span class="number">3</span></span><br><span class="line">bbb</span><br></pre></td></tr></table></figure>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    intArrayOf(<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>).forEach &#123;</span><br><span class="line">        <span class="keyword">if</span>(it == <span class="number">2</span>)</span><br><span class="line">      			<span class="comment">/**</span></span><br><span class="line"><span class="comment">      			* 全局return。直接退出main函数</span></span><br><span class="line"><span class="comment">      			**/</span></span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">        println(it)</span><br><span class="line">    &#125;</span><br><span class="line">    println(<span class="string">"bbb"</span>)</span><br><span class="line">    <span class="keyword">return</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 打印结果</span></span><br><span class="line"><span class="number">1</span></span><br></pre></td></tr></table></figure>
<p>因为foreach是内联函数，转为java之后</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> static <span class="keyword">final</span> void main() &#123;</span><br><span class="line">     int[] $<span class="keyword">this</span>$forEach$iv = new int[]&#123;<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>&#125;;</span><br><span class="line">     int[] var2 = $<span class="keyword">this</span>$forEach$iv;</span><br><span class="line">     int var3 = $<span class="keyword">this</span>$forEach$iv.length;</span><br><span class="line">  </span><br><span class="line">     <span class="keyword">for</span>(int var4 = <span class="number">0</span>; var4 &lt; var3; ++var4) &#123;</span><br><span class="line">        int element$iv = var2[var4];</span><br><span class="line">        <span class="keyword">if</span> (element$iv == <span class="number">2</span>) &#123;</span><br><span class="line">           <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        System.<span class="keyword">out</span>.println(element$iv);</span><br><span class="line">     &#125;</span><br><span class="line">     String var9 = <span class="string">"bbb"</span>;</span><br><span class="line">     System.<span class="keyword">out</span>.println(var9);</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>noinline关键字可以取消函数参数的内联</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">inline</span> <span class="function"><span class="keyword">fun</span> <span class="title">limit</span><span class="params">( <span class="keyword">noinline</span> p1:()</span></span>-&gt;<span class="built_in">Unit</span>)&#123;</span><br><span class="line">    print(<span class="string">"limit"</span>)</span><br><span class="line">    p1()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">   limit &#123; print(<span class="string">"xxx"</span>)  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>转为java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  Function0 p1$iv = (Function0)<span class="keyword">null</span>.INSTANCE;</span><br><span class="line">  <span class="keyword">int</span> $i$f$limit = <span class="keyword">false</span>;</span><br><span class="line">  <span class="comment">//函数内联了</span></span><br><span class="line">  String var2 = <span class="string">"limit"</span>;</span><br><span class="line">  System.out.print(var2);</span><br><span class="line">  <span class="comment">//函数参数没有内联</span></span><br><span class="line">  p1$iv.invoke();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>crossinline关键字不允许非局部返回</p>
<p>非局部return的时候return的是调用的地方，lambda函数就没有了返回值，这种情况在某些情景下是有问题的，所以就有了crossinline关键字</p>
<p>为什么要有crossinline可以参考：<a href="https://blog.csdn.net/u013009899/article/details/78584994，这里有例子。" target="_blank" rel="noopener">https://blog.csdn.net/u013009899/article/details/78584994，这里有例子。</a></p>
<p>说白了，就是我们如果直接在lambda参数中结束当前函数，而不给lambda提供一个返回值，这种情况是不被允许的</p>
</li>
<li><p>内联函数的没有被声明为noinline的函数（lambda）参数不能被存储</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">inline</span> <span class="function"><span class="keyword">fun</span> <span class="title">limit</span><span class="params">(p1:()</span></span>-&gt;<span class="built_in">Unit</span>)&#123;</span><br><span class="line">  	<span class="comment">//编译出错</span></span><br><span class="line">    <span class="keyword">val</span> a = p1</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h5 id="几个有用的高阶函数"><a href="#几个有用的高阶函数" class="headerlink" title="几个有用的高阶函数"></a>几个有用的高阶函数</h5><ol>
<li><p>let  返回值是block的返回值</p>
<p>比如fragment的oncreate方法中解析bundle的内容</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">onCreate</span><span class="params">(savedInstanceState: <span class="type">Bundle</span>?)</span></span> &#123;</span><br><span class="line">    <span class="keyword">super</span>.onCreate(savedInstanceState)</span><br><span class="line">    arguments?.let &#123; <span class="comment">// it</span></span><br><span class="line">        imageId = it.getInt(ARG_IMAGE)</span><br><span class="line">        tip = it.getString(ARG_TIP)</span><br><span class="line">        bgColor = it.getInt(ARG_BG_COLOR)</span><br><span class="line">        smallBgImg = it.getInt(ARG_SMALL_BG_IMAGE)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>run  返回值是block的返回值</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">onCreate</span><span class="params">(savedInstanceState: <span class="type">Bundle</span>?)</span></span> &#123;</span><br><span class="line">    <span class="keyword">super</span>.onCreate(savedInstanceState)</span><br><span class="line">    arguments?.run &#123; <span class="comment">//this</span></span><br><span class="line">        imageId = getInt(ARG_IMAGE)</span><br><span class="line">        tip = getString(ARG_TIP)</span><br><span class="line">        bgColor = getInt(ARG_BG_COLOR)</span><br><span class="line">        smallBgImg = getInt(ARG_SMALL_BG_IMAGE)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ol>
<ol start="3">
<li><p>also   返回值跟调用者是同一个实例</p>
</li>
<li><p>apply   <strong>T.apply(block: T.() -&gt; Unit): T</strong>   返回值跟调用者是同一个实例（比如下面例子，loadingDialog实例调用的，返回值还是那个实例）</p>
<p>例子1: fragment的newInstance方法</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">companion</span> <span class="keyword">object</span> &#123;</span><br><span class="line">    <span class="meta">@JvmStatic</span></span><br><span class="line">    <span class="function"><span class="keyword">fun</span> <span class="title">newInstance</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">        <span class="meta">@DrawableRes</span> imageId: <span class="type">Int</span>,</span></span></span><br><span class="line"><span class="function"><span class="params">        tip: <span class="type">String</span>? = <span class="literal">null</span>,</span></span></span><br><span class="line"><span class="function"><span class="params">        <span class="meta">@ColorRes</span> bgColor: <span class="type">Int</span> = <span class="number">-1</span>,</span></span></span><br><span class="line"><span class="function"><span class="params">        <span class="meta">@DrawableRes</span> smallBgImg: <span class="type">Int</span> = <span class="number">-1</span></span></span></span><br><span class="line"><span class="function"><span class="params">    )</span></span> =</span><br><span class="line">        LoadingDialog().apply &#123; <span class="comment">// this</span></span><br><span class="line">            arguments = Bundle().apply &#123; <span class="comment">// this</span></span><br><span class="line">                putInt(ARG_IMAGE, imageId)</span><br><span class="line">                putString(ARG_TIP, tip)</span><br><span class="line">                putInt(ARG_BG_COLOR, bgColor)</span><br><span class="line">                putInt(ARG_SMALL_BG_IMAGE, smallBgImg)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>例子2: build模式 ( OkHttpClient源码 )</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">addInterceptor</span><span class="params">(interceptor: <span class="type">Interceptor</span>)</span></span> = apply &#123;</span><br><span class="line">  interceptors += interceptor</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">addNetworkInterceptor</span><span class="params">(interceptor: <span class="type">Interceptor</span>)</span></span> = apply &#123;</span><br><span class="line">  networkInterceptors += interceptor</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>use</p>
<p>不用自己关闭流</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">File(<span class="string">"build.gradle"</span>).inputStream().reader().buffered()</span><br><span class="line">    .use &#123;</span><br><span class="line">        print(it.readLine())</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
</li>
</ol>
<h5 id="集合变换与序列"><a href="#集合变换与序列" class="headerlink" title="集合变换与序列"></a>集合变换与序列</h5><ul>
<li><p>filter</p>
<p>过滤集合</p>
</li>
<li><p>map</p>
<p>元素一对一映射之后拼接</p>
</li>
<li><p>flatmap</p>
<p>每个元素映射为一个集合，之后把所有的集合拼接起来</p>
</li>
<li><p>asSequence</p>
<p>懒汉式序列</p>
</li>
</ul>
<p>  eg：饿汉式如下</p>
  <figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">arr.filter &#123;</span><br><span class="line">  println(<span class="string">"filter <span class="variable">$it</span>"</span>)</span><br><span class="line">  it % <span class="number">2</span> == <span class="number">0</span></span><br><span class="line">&#125;.map &#123;</span><br><span class="line">  println(<span class="string">"map <span class="variable">$it</span>"</span>)</span><br><span class="line">  it * <span class="number">2</span></span><br><span class="line">&#125;.flatMap &#123;</span><br><span class="line">  println(<span class="string">"flatMap <span class="variable">$it</span>"</span>)</span><br><span class="line">  <span class="number">0.</span>.it</span><br><span class="line">&#125;.forEach &#123;</span><br><span class="line">  println(<span class="string">"foreach <span class="variable">$it</span>"</span>)</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//输出：</span></span><br><span class="line">filter <span class="number">1</span></span><br><span class="line">filter <span class="number">2</span></span><br><span class="line">filter <span class="number">3</span></span><br><span class="line">filter <span class="number">4</span></span><br><span class="line">map <span class="number">2</span></span><br><span class="line">map <span class="number">4</span></span><br><span class="line">flatMap <span class="number">4</span></span><br><span class="line">flatMap <span class="number">8</span></span><br><span class="line">foreach <span class="number">0</span></span><br><span class="line">foreach <span class="number">1</span></span><br><span class="line">foreach <span class="number">2</span></span><br><span class="line">foreach <span class="number">3</span></span><br><span class="line">foreach <span class="number">4</span></span><br><span class="line">foreach <span class="number">0</span></span><br><span class="line">foreach <span class="number">1</span></span><br><span class="line">foreach <span class="number">2</span></span><br><span class="line">foreach <span class="number">3</span></span><br><span class="line">foreach <span class="number">4</span></span><br><span class="line">foreach <span class="number">5</span></span><br><span class="line">foreach <span class="number">6</span></span><br><span class="line">foreach <span class="number">7</span></span><br><span class="line">foreach <span class="number">8</span></span><br></pre></td></tr></table></figure>
<p>  添加 asSequence之后变为懒汉，<strong>foreach类似水龙头开关，没有的话，啥也不会输出</strong></p>
  <figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">arr.asSequence()</span><br><span class="line">    .filter &#123;</span><br><span class="line">        println(<span class="string">"filter <span class="variable">$it</span>"</span>)</span><br><span class="line">        it % <span class="number">2</span> == <span class="number">0</span></span><br><span class="line">    &#125;.map &#123;</span><br><span class="line">        println(<span class="string">"map <span class="variable">$it</span>"</span>)</span><br><span class="line">        it * <span class="number">2</span></span><br><span class="line">    &#125;.forEach &#123;</span><br><span class="line">        println(<span class="string">"foreach <span class="variable">$it</span>"</span>)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//输出：</span></span><br><span class="line">filter <span class="number">1</span></span><br><span class="line">filter <span class="number">2</span></span><br><span class="line">map <span class="number">2</span></span><br><span class="line">foreach <span class="number">4</span></span><br><span class="line">filter <span class="number">3</span></span><br><span class="line">filter <span class="number">4</span></span><br><span class="line">map <span class="number">4</span></span><br><span class="line">foreach <span class="number">8</span></span><br></pre></td></tr></table></figure>
<ul>
<li><p>sum 求和</p>
</li>
<li><p>reduce （没有初始值，返回值跟item一个类型）</p>
<p>源码：</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">inline</span> <span class="function"><span class="keyword">fun</span> IntArray.<span class="title">reduce</span><span class="params">(operation: (<span class="type">acc</span>: <span class="type">Int</span>, <span class="built_in">Int</span>)</span></span> -&gt; <span class="built_in">Int</span>): <span class="built_in">Int</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (isEmpty())</span><br><span class="line">        <span class="keyword">throw</span> UnsupportedOperationException(<span class="string">"Empty array can't be reduced."</span>)</span><br><span class="line">    <span class="keyword">var</span> accumulator = <span class="keyword">this</span>[<span class="number">0</span>]</span><br><span class="line">    <span class="keyword">for</span> (index <span class="keyword">in</span> <span class="number">1.</span>.lastIndex) &#123;</span><br><span class="line">        accumulator = operation(accumulator, <span class="keyword">this</span>[index])</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> accumulator</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>例子：求和</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">val</span> arr = intArrayOf(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>)</span><br><span class="line">arr.reduce &#123; acc, i -&gt;</span><br><span class="line">    acc + i</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>fold（给一个初始值，对每一个item做同样的operation,返回值跟初始值一个类型）</p>
<p>源码：</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">inline</span> <span class="function"><span class="keyword">fun</span> <span class="type">&lt;R&gt;</span> IntArray.<span class="title">fold</span><span class="params">(initial: <span class="type">R</span>, operation: (<span class="type">acc</span>: <span class="type">R</span>, <span class="built_in">Int</span>)</span></span> -&gt; R): R &#123;</span><br><span class="line">    <span class="keyword">var</span> accumulator = initial</span><br><span class="line">    <span class="keyword">for</span> (element <span class="keyword">in</span> <span class="keyword">this</span>) accumulator = operation(accumulator, element)</span><br><span class="line">    <span class="keyword">return</span> accumulator</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>例子：求和</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">val</span> arr = intArrayOf(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>)</span><br><span class="line"><span class="keyword">val</span> fold = arr.fold(<span class="number">0</span>) &#123; acc, i -&gt;</span><br><span class="line">    acc + i</span><br><span class="line">&#125;</span><br><span class="line">print(fold)</span><br><span class="line"><span class="comment">//10</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
<h5 id="sam转换（single-abstract-method）"><a href="#sam转换（single-abstract-method）" class="headerlink" title="sam转换（single abstract method）"></a>sam转换（single abstract method）</h5><p>eg:匿名内部类Runnable</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">Thread(</span><br><span class="line">    <span class="keyword">object</span> : Runnable &#123;</span><br><span class="line">        <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">run</span><span class="params">()</span></span> &#123;</span><br><span class="line">            print(<span class="string">"run"</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">).start()</span><br></pre></td></tr></table></figure>
<p>简写如下：</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Thread(</span><br><span class="line">    Runnable &#123; print(<span class="string">"run"</span>) &#125;</span><br><span class="line">).start()</span><br></pre></td></tr></table></figure>
<p>SAM之后</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Thread &#123; print(<span class="string">"run"</span>) &#125;</span><br><span class="line">            .start()</span><br></pre></td></tr></table></figure>
<p>eg:设置点击监听</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">callWithDialog.setOnClickListener(<span class="keyword">object</span>:View.OnClickListener&#123;</span><br><span class="line">  <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">onClick</span><span class="params">(v: <span class="type">View</span>?)</span></span> &#123;</span><br><span class="line">    println(<span class="string">"onclick"</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>sam之后，可以简写为</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">callWithDialog.setOnClickListener &#123; println(<span class="string">"onclick"</span>) &#125;</span><br></pre></td></tr></table></figure>
<p><strong>调用java的时候可以，如果单方法接口是kotlin，那么不支持。</strong></p>
<h5 id="实例：统计文本中字符（不含空格）出现个数"><a href="#实例：统计文本中字符（不含空格）出现个数" class="headerlink" title="实例：统计文本中字符（不含空格）出现个数"></a>实例：统计文本中字符（不含空格）出现个数</h5><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">File(<span class="string">"build.gradle"</span>)</span><br><span class="line">    .readText()</span><br><span class="line">    .toCharArray()</span><br><span class="line">    .filterNot &#123;</span><br><span class="line">        it.isWhitespace()</span><br><span class="line">    &#125;</span><br><span class="line">    .groupBy &#123; it &#125;</span><br><span class="line">    .map &#123; it.key to it.value.size &#125;</span><br><span class="line">    .let &#123;</span><br><span class="line">        print(it)</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<h5 id="tip"><a href="#tip" class="headerlink" title="tip"></a>tip</h5><p>this@MainActivity : 内部类获取context的方法</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2020/06/09/kotlin-基础/" data-id="ckfouenp9002i3quqgi731s6n" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/kotlin/">kotlin</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-后台开发" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2020/03/19/后台开发/" class="article-date">
  <time datetime="2020-03-19T03:27:56.000Z" itemprop="datePublished">2020-03-19</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2020/03/19/后台开发/">后台开发</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h5 id="环境"><a href="#环境" class="headerlink" title="环境"></a>环境</h5><ol>
<li><p>node</p>
</li>
<li><p>npm</p>
</li>
<li><p>yarn（取代npm）</p>
</li>
</ol>
<p>node安装（自带npm）：<a href="https://www.cnblogs.com/mumusen/p/9760732.html" target="_blank" rel="noopener">https://www.cnblogs.com/mumusen/p/9760732.html</a></p>
<p>yarn安装：<a href="https://www.cnblogs.com/mumusen/p/9760732.html" target="_blank" rel="noopener">https://www.cnblogs.com/mumusen/p/9760732.html</a></p>
<h5 id="技术栈"><a href="#技术栈" class="headerlink" title="技术栈"></a>技术栈</h5><p>vue</p>
<p>vue-router</p>
<p>vuex</p>
<p>antd pro ：<a href="https://pro.loacg.com/docs/getting-started" target="_blank" rel="noopener">https://pro.loacg.com/docs/getting-started</a></p>
<p>springboot（kotlin）</p>
<h5 id="登录"><a href="#登录" class="headerlink" title="登录"></a>登录</h5><p><a href="https://www.jianshu.com/p/ffe2790578fe" target="_blank" rel="noopener">https://www.jianshu.com/p/ffe2790578fe</a></p>
<h5 id="vue-ls"><a href="#vue-ls" class="headerlink" title="vue.ls"></a>vue.ls</h5><p>一个vue封装的本地储存的方法</p>
<p><a href="https://www.jianshu.com/p/ab7f67878279" target="_blank" rel="noopener">https://www.jianshu.com/p/ab7f67878279</a></p>
<h5 id="vue-config-js"><a href="#vue-config-js" class="headerlink" title="vue.config.js"></a>vue.config.js</h5><p><a href="https://www.jianshu.com/p/b358a91bdf2d" target="_blank" rel="noopener">https://www.jianshu.com/p/b358a91bdf2d</a></p>
<h5 id="验证码"><a href="#验证码" class="headerlink" title="验证码"></a>验证码</h5><ol>
<li>前端请求验证码：生成一个unique传递给后端</li>
<li>后端画图生成验证码，返回给前端：将{unique: versifycode }使用redis缓存</li>
<li>前端请求验证 ：带着unique跟输入的verifyCode</li>
<li>后端验证：根据unique获取verifyCode，比对</li>
</ol>
<h5 id="antd-pro访问本地springboot服务"><a href="#antd-pro访问本地springboot服务" class="headerlink" title="antd pro访问本地springboot服务"></a>antd pro访问本地springboot服务</h5><ol>
<li><p>禁用mock</p>
<p>Main.js中注释掉 import ‘./mock’</p>
</li>
<li><p>设置query的url ，为springboot的server地址</p>
<p>env.development:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">NODE_ENV=development</span><br><span class="line">VUE_APP_PREVIEW=false</span><br><span class="line">VUE_APP_API_BASE_URL=http://localhost:8082</span><br></pre></td></tr></table></figure>
</li>
</ol>
<p>   <del>修改vue.config.js</del></p>
   <figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">devServer: &#123;</span><br><span class="line">    <span class="comment">// development server port 8888</span></span><br><span class="line">    port: <span class="number">8000</span>,</span><br><span class="line">    proxy: &#123;</span><br><span class="line">      <span class="string">'/api'</span>: &#123; <span class="comment">// 匹配模式，所有api开始的连接都匹配到下面服务器地址</span></span><br><span class="line">        target: VUE_APP_API_BASE_URL, <span class="comment">// 这是开发服务器的地址</span></span><br><span class="line">        ws: <span class="literal">false</span>,</span><br><span class="line">        changeOrigin: <span class="literal">true</span>, </span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br></pre></td></tr></table></figure>
<ol start="3">
<li><p>此时因为跨域问题会报错：</p>
<p><strong>has been blocked by CORS policy: No ‘Access-Control-Allow-Origin’ header is present on the requested resource.</strong></p>
</li>
<li><p>后端解决：<a href="https://juejin.im/entry/5a0a52ab6fb9a045016777bf" target="_blank" rel="noopener">https://juejin.im/entry/5a0a52ab6fb9a045016777bf</a></p>
</li>
</ol>
<h5 id="后端登录逻辑"><a href="#后端登录逻辑" class="headerlink" title="后端登录逻辑"></a>后端登录逻辑</h5><p>参见开发文档</p>
<h5 id="正式环境配置"><a href="#正式环境配置" class="headerlink" title="正式环境配置"></a>正式环境配置</h5><p>后端：</p>
<ul>
<li>mysql（使用lszy小程序的，需要导入admin_api相关的table）oss备份</li>
<li>redis（使用lszy小程序的，暂时没有需要处理的）</li>
<li>jenkins ： 新建task（拉取代码之后，使用maven构建生成jar包，之后在容器中运行该jar包）</li>
<li>后端容器：运行服务端程序（jar）</li>
<li>nginx代理（使用lszy小程序的，增加admin_api的代理）</li>
</ul>
<p>前端：</p>
<ul>
<li>Node：尝试新建node镜像跟容器，完成前端项目构建<ul>
<li>dockerFile（nodejs，yarn）</li>
<li>启动镜像，设置挂载</li>
<li>启动之后自动执行打包命令</li>
</ul>
</li>
<li>nginx代理：使用lszy小程序的，增加admin_web的代理</li>
<li>nginx server（前端容器）：部署admin_web</li>
<li>jenkins：新建task（拉取代码之后使用node容器构建，之后部署到nginx server容器）</li>
</ul>
<h5 id="jenkins-关联git"><a href="#jenkins-关联git" class="headerlink" title="jenkins 关联git"></a>jenkins 关联git</h5><h5 id="数据库8-0连接问题"><a href="#数据库8-0连接问题" class="headerlink" title="数据库8.0连接问题"></a>数据库8.0连接问题</h5><ul>
<li><p><del><a href="https://www.iteye.com/blog/binary-space-2412769" target="_blank" rel="noopener">https://www.iteye.com/blog/binary-space-2412769</a></del></p>
</li>
<li><p>使用navicat</p>
</li>
</ul>
<h5 id="分页-mybatis"><a href="#分页-mybatis" class="headerlink" title="分页(mybatis)"></a>分页(mybatis)</h5><ol>
<li><p>定义mapper</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">interface</span> <span class="title">UserMapper</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">fun</span> <span class="title">list</span><span class="params">(start: <span class="type">Int</span>, pageSize: <span class="type">Int</span>, phone: <span class="type">String</span>?,</span></span></span><br><span class="line"><span class="function"><span class="params">             startTime: <span class="type">String</span>?, endTime: <span class="type">String</span>?, nick_name: <span class="type">String</span>?,</span></span></span><br><span class="line"><span class="function"><span class="params">             gender: <span class="type">Int</span> = <span class="number">0</span>, grade: <span class="type">Int</span> = <span class="number">0</span>, provinceId: <span class="type">Int</span> = <span class="number">0</span>,</span></span></span><br><span class="line"><span class="function"><span class="params">             cityId: <span class="type">Int</span> = <span class="number">0</span>, countyId: <span class="type">Int</span> = <span class="number">0</span>, schoolId: <span class="type">Int</span> = <span class="number">0</span>)</span></span>: List&lt;User&gt;?</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">fun</span> <span class="title">count</span><span class="params">(phone: <span class="type">String</span>?,</span></span></span><br><span class="line"><span class="function"><span class="params">              startTime: <span class="type">String</span>?, endTime: <span class="type">String</span>?, nick_name: <span class="type">String</span>?,</span></span></span><br><span class="line"><span class="function"><span class="params">              gender: <span class="type">Int</span> = <span class="number">0</span>, grade: <span class="type">Int</span> = <span class="number">0</span>, provinceId: <span class="type">Int</span> = <span class="number">0</span>,</span></span></span><br><span class="line"><span class="function"><span class="params">              cityId: <span class="type">Int</span> = <span class="number">0</span>, countyId: <span class="type">Int</span> = <span class="number">0</span>, schoolId: <span class="type">Int</span> = <span class="number">0</span>)</span></span>: <span class="built_in">Int</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>定义xml</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span><br><span class="line"><span class="meta">&lt;!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd"&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">"com.lingshiedu.lszyAdmin.mapper.UserMapper"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"list"</span> <span class="attr">resultType</span>=<span class="string">"com.lingshiedu.lszyAdmin.model.User"</span>&gt;</span></span><br><span class="line">        select</span><br><span class="line">        ls_user.id,</span><br><span class="line">        ls_user.nick_name,</span><br><span class="line">        ls_user.phone,</span><br><span class="line">        ls_user.province_id,</span><br><span class="line">        ls_user.city_id,</span><br><span class="line">        ls_user.county_id,</span><br><span class="line">        ls_user.school_id,</span><br><span class="line">        ls_user.grade_id,</span><br><span class="line">        ls_user.state,</span><br><span class="line">        ls_schools.name as school_name,</span><br><span class="line">        ls_user.gender,</span><br><span class="line">        ls_user.adv_score,</span><br><span class="line">        ls_user.occurrence_Time</span><br><span class="line">        from ls_user</span><br><span class="line">        INNER JOIN ls_schools ON ls_user.school_id = ls_schools.id</span><br><span class="line">        <span class="tag">&lt;<span class="name">where</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">"phone != null"</span>&gt;</span></span><br><span class="line">                AND phone=#&#123;phone&#125;</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">"nick_name != null"</span>&gt;</span></span><br><span class="line">                AND nick_name LIKE CONCAT('%', #&#123;nick_name&#125;, '%')</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">"gender != 0"</span>&gt;</span></span><br><span class="line">                AND gender=#&#123;gender&#125;</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">"grade != 0"</span>&gt;</span></span><br><span class="line">                AND grade_id=#&#123;grade&#125;</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">"startTime!=null and endTime!=null "</span>&gt;</span></span><br><span class="line">                occurrence_Time BETWEEN #&#123;startTime&#125; and #&#123;endTime&#125;</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">"provinceId != 0"</span>&gt;</span></span><br><span class="line">                AND province_id = #&#123;provinceId&#125;</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">"cityId != 0"</span>&gt;</span></span><br><span class="line">                AND city_id = #&#123;cityId&#125;</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">"countyId != 0"</span>&gt;</span></span><br><span class="line">                AND county_id = #&#123;countyId&#125;</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">"schoolId != 0"</span>&gt;</span></span><br><span class="line">                AND school_id = #&#123;schoolId&#125;</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">where</span>&gt;</span></span><br><span class="line">        order by ls_user.occurrence_Time</span><br><span class="line">        LIMIT #&#123;start&#125;,</span><br><span class="line">        #&#123;pageSize&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"count"</span> <span class="attr">resultType</span>=<span class="string">"int"</span>&gt;</span></span><br><span class="line">        select</span><br><span class="line">        COUNT(*)</span><br><span class="line">        from ls_user</span><br><span class="line">        INNER JOIN ls_schools ON ls_user.school_id = ls_schools.id</span><br><span class="line">        <span class="tag">&lt;<span class="name">where</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">"phone != null"</span>&gt;</span></span><br><span class="line">                AND phone=#&#123;phone&#125;</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">"nick_name != null"</span>&gt;</span></span><br><span class="line">                AND nick_name LIKE CONCAT('%', #&#123;nick_name&#125;, '%')</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">"gender != 0"</span>&gt;</span></span><br><span class="line">                AND gender=#&#123;gender&#125;</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">"grade != 0"</span>&gt;</span></span><br><span class="line">                AND grade_id=#&#123;grade&#125;</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">"startTime!=null and endTime!=null "</span>&gt;</span></span><br><span class="line">                occurrence_Time BETWEEN #&#123;startTime&#125; and #&#123;endTime&#125;</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">"provinceId != 0"</span>&gt;</span></span><br><span class="line">                AND province_id = #&#123;provinceId&#125;</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">"cityId != 0"</span>&gt;</span></span><br><span class="line">                AND city_id = #&#123;cityId&#125;</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">"countyId != 0"</span>&gt;</span></span><br><span class="line">                AND county_id = #&#123;countyId&#125;</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">"schoolId != 0"</span>&gt;</span></span><br><span class="line">                AND school_id = #&#123;schoolId&#125;</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">where</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
</ol>
<h5 id="nginx命令"><a href="#nginx命令" class="headerlink" title="nginx命令"></a>nginx命令</h5><ul>
<li><p>nginx -s reopen #重启Nginx</p>
</li>
<li><p>nginx -s reload #重新加载Nginx配置文件，然后以优雅的方式重启Nginx</p>
</li>
<li><p>nginx -s stop #强制停止Nginx服务</p>
</li>
<li><p>nginx -s quit #优雅地停止Nginx服务（即处理完所有请求后再停止服务）</p>
</li>
<li><p>nginx -t #检测配置文件是否有语法错误，然后退出</p>
</li>
<li><p>nginx -?,-h #打开帮助信息</p>
</li>
<li><p>nginx -v #显示版本信息并退出</p>
</li>
<li><p>nginx -V #显示版本和配置选项信息，然后退出</p>
</li>
<li><p>nginx -t #检测配置文件是否有语法错误，然后退出</p>
</li>
<li><p>nginx -T #检测配置文件是否有语法错误，转储并退出</p>
</li>
<li><p>nginx -q #在检测配置文件期间屏蔽非错误信息</p>
</li>
<li><p>nginx -p prefix #设置前缀路径(默认是:/usr/share/nginx/)</p>
</li>
<li><p>nginx -c filename #设置配置文件(默认是:/etc/nginx/nginx.conf)</p>
</li>
<li><p>nginx -g directives #设置配置文件外的全局指令</p>
</li>
<li><p>killall nginx #杀死所有nginx进程</p>
</li>
</ul>
<h5 id="docker-nginx-挂载nginx-conf文件不同步问题："><a href="#docker-nginx-挂载nginx-conf文件不同步问题：" class="headerlink" title="docker nginx 挂载nginx.conf文件不同步问题："></a>docker nginx 挂载nginx.conf文件不同步问题：</h5><p><a href="https://blog.csdn.net/qq_41980563/article/details/90408460?depth_1-utm_source=distribute.pc_relevant.none-task&amp;utm_source=distribute.pc_relevant.none-task" target="_blank" rel="noopener">https://blog.csdn.net/qq_41980563/article/details/90408460?depth_1-utm_source=distribute.pc_relevant.none-task&amp;utm_source=distribute.pc_relevant.none-task</a></p>
<h5 id="dockerfile-传参-区分正式环境跟测试环境"><a href="#dockerfile-传参-区分正式环境跟测试环境" class="headerlink" title="dockerfile 传参(区分正式环境跟测试环境)"></a>dockerfile 传参(区分正式环境跟测试环境)</h5><ul>
<li><p><a href="https://blog.justwe.site/post/docker-arg-env/" target="_blank" rel="noopener">https://blog.justwe.site/post/docker-arg-env/</a></p>
</li>
<li><p><a href="https://www.jianshu.com/p/7886055680a8" target="_blank" rel="noopener">https://www.jianshu.com/p/7886055680a8</a></p>
</li>
<li><p>arg：build过程（构建镜像过程）</p>
</li>
<li>env：run过程（容器启动之后）</li>
</ul>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">FROM</span> node:<span class="number">13.11</span>.<span class="number">0</span></span><br><span class="line"><span class="keyword">RUN</span><span class="bash"> npm install -y yarn</span></span><br><span class="line"><span class="bash">WORKDIR /app/lszy_admin_web</span></span><br><span class="line"><span class="bash">COPY package.json ./</span></span><br><span class="line"><span class="bash">COPY yarn.lock ./</span></span><br><span class="line"><span class="bash">RUN yarn install</span></span><br><span class="line"><span class="bash">COPY ./ ./</span></span><br><span class="line"><span class="bash"><span class="comment"># 定义arg参数</span></span></span><br><span class="line"><span class="bash">ARG arg=<span class="string">""</span></span></span><br><span class="line"><span class="bash"><span class="comment"># 定义容器启动之后的参数build_env</span></span></span><br><span class="line"><span class="bash">ENV build_env=<span class="variable">$&#123;arg&#125;</span></span></span><br><span class="line"><span class="bash">CMD yarn <span class="variable">$&#123;build_env&#125;</span> &amp;&amp; cp -rf dist dist_</span></span><br></pre></td></tr></table></figure>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> arg设置为build(正式环境)</span></span><br><span class="line">docker build --build-arg arg=build . -t node_lszy_admin_web</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> arg设置为build(测试环境)</span></span><br><span class="line">docker build --build-arg arg=build:test . -t node_lszy_admin_web</span><br></pre></td></tr></table></figure>
<h5 id="后台管理员以及权限"><a href="#后台管理员以及权限" class="headerlink" title="后台管理员以及权限"></a>后台管理员以及权限</h5><p>antdesign流程：</p>
<ol>
<li><p>main.js中引入router模块并设置基础路由</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">new</span> Router(&#123;</span><br><span class="line">  ...</span><br><span class="line">  routes: constantRouterMap</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
</li>
<li><p>permission.js中添加router拦截器</p>
<ol>
<li>如果有token（token使用vue.ls存放在本地）<pre><code>1.  如果路由目的地是login，那么重定向到defaultPage
 2.  否则，如果可达的页面为空，那么调用store中的GetAdminUserInfo，成功之后先修改store中的pages信息之后调用store中的GenerateRoutes根据服务端返回的数据更新路由。路由更新完毕之后根据路由跳转
</code></pre></li>
<li>如果没有token，那么跳转登录页面（在免登录名单中的不用登录）</li>
</ol>
<p>具体代码如下：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">router.beforeEach(<span class="function">(<span class="params">to, <span class="keyword">from</span>, next</span>) =&gt;</span> &#123;</span><br><span class="line">  NProgress.start() <span class="comment">// start progress bar</span></span><br><span class="line">  to.meta &amp;&amp; (<span class="keyword">typeof</span> to.meta.title !== <span class="string">'undefined'</span> &amp;&amp; setDocumentTitle(<span class="string">`<span class="subst">$&#123;to.meta.title&#125;</span> - <span class="subst">$&#123;domTitle&#125;</span>`</span>))</span><br><span class="line">  <span class="keyword">if</span> (Vue.ls.get(ACCESS_TOKEN)) &#123;</span><br><span class="line">    <span class="comment">/* has token */</span></span><br><span class="line">    <span class="keyword">if</span> (to.path === <span class="string">'/admin/login'</span>) &#123;</span><br><span class="line">      next(&#123; <span class="attr">path</span>: defaultRoutePath &#125;)</span><br><span class="line">      NProgress.done()</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> (store.getters.pages.length === <span class="number">0</span>) &#123;</span><br><span class="line">        store</span><br><span class="line">          .dispatch(<span class="string">'GetAdminUserInfo'</span>)</span><br><span class="line">          .then(<span class="function"><span class="params">res</span> =&gt;</span> &#123;</span><br><span class="line">            <span class="keyword">const</span> pages = res.data.pages</span><br><span class="line">            store.dispatch(<span class="string">'GenerateRoutes'</span>, &#123; pages &#125;).then(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">              <span class="comment">// 根据roles权限生成可访问的路由表</span></span><br><span class="line">              <span class="comment">// 动态添加可访问路由表</span></span><br><span class="line">              router.addRoutes(store.getters.addRouters)</span><br><span class="line">              <span class="comment">// 请求带有 redirect 重定向时，登录自动重定向到该地址</span></span><br><span class="line">              <span class="keyword">const</span> redirect = <span class="built_in">decodeURIComponent</span>(<span class="keyword">from</span>.query.redirect || to.path)</span><br><span class="line">              <span class="keyword">if</span> (to.path === redirect) &#123;</span><br><span class="line">                <span class="comment">// hack方法 确保addRoutes已完成 ,set the replace: true so the navigation will not leave a history record</span></span><br><span class="line">                next(&#123; ...to, <span class="attr">replace</span>: <span class="literal">true</span> &#125;)</span><br><span class="line">              &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="comment">// 跳转到目的路由</span></span><br><span class="line">                next(&#123; <span class="attr">path</span>: redirect &#125;)</span><br><span class="line">              &#125;</span><br><span class="line">            &#125;)</span><br><span class="line">          &#125;)</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        next()</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (whiteList.includes(to.name)) &#123;</span><br><span class="line">      <span class="comment">// 在免登录白名单，直接进入</span></span><br><span class="line">      next()</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      next(&#123; <span class="attr">path</span>: <span class="string">'/admin/login'</span>, <span class="attr">query</span>: &#123; <span class="attr">redirect</span>: to.fullPath &#125; &#125;)</span><br><span class="line">      NProgress.done() <span class="comment">// if current page is login will not trigger afterEach hook, so manually handle it</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
</li>
</ol>
<h5 id="vue中ref使用（跟子组件通信-emit）"><a href="#vue中ref使用（跟子组件通信-emit）" class="headerlink" title="vue中ref使用（跟子组件通信+emit）"></a>vue中ref使用（跟子组件通信+emit）</h5><p><a href="https://www.jianshu.com/p/623c8b009a85" target="_blank" rel="noopener">https://www.jianshu.com/p/623c8b009a85</a></p>
<h5 id="后端日志（log4j2）"><a href="#后端日志（log4j2）" class="headerlink" title="后端日志（log4j2）"></a>后端日志（log4j2）</h5><p><a href="https://www.cnblogs.com/LemonFive/p/10737658.html" target="_blank" rel="noopener">https://www.cnblogs.com/LemonFive/p/10737658.html</a></p>
<h5 id="登陆服务器快捷方式"><a href="#登陆服务器快捷方式" class="headerlink" title="登陆服务器快捷方式"></a>登陆服务器快捷方式</h5><h6 id="客户端"><a href="#客户端" class="headerlink" title="客户端"></a>客户端</h6><ol>
<li><p>打开~/.ssh，如果没有则创建文件夹</p>
</li>
<li><p>执行ssh-keygen -t rsa</p>
<p>  Enter file in which to save the key：输入保存私钥的文件名称(id_rsa_host)</p>
<p>  Enter passphrase (empty for no passphrase): (可以不写)</p>
<p>  Enter same passphrase again:(可以不写)</p>
<p>  此时会生成：id_rsa_host文件</p>
</li>
<li><p>ssh-add ~/.ssh/id_rsa_host，通过私钥创建公钥</p>
<p>  此时会生成：id_rsa_host.pub文件</p>
</li>
</ol>
<h6 id="服务端"><a href="#服务端" class="headerlink" title="服务端"></a>服务端</h6><ol>
<li><p>打开~/.ssh，如果没有则创建文件夹</p>
</li>
<li><p>打开authorized_keys，将客户端第3步生成的文件中的公钥保存到此文件中，如果有多个则，换行处理</p>
</li>
</ol>
<h6 id="快捷连接设置"><a href="#快捷连接设置" class="headerlink" title="快捷连接设置"></a>快捷连接设置</h6><p>在客户端，~/.ssh下创建config文件</p>
<p>内容如下</p>
<p>Host dev<br>  HostName hostIp<br>  PreferredAuthentications publickey<br>  IdentityFile ~/.ssh/id_rsa_host<br>  User username</p>
<h6 id="完成，测试"><a href="#完成，测试" class="headerlink" title="完成，测试"></a>完成，测试</h6><p>ssh dev</p>
<p>回车即可</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2020/03/19/后台开发/" data-id="ckfouenqv004b3quq56npievn" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-mysql添加索引解决速度问题" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2020/03/18/mysql添加索引解决速度问题/" class="article-date">
  <time datetime="2020-03-18T02:57:28.000Z" itemprop="datePublished">2020-03-18</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2020/03/18/mysql添加索引解决速度问题/">Mysql添加索引解决速度问题</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>问题：执行update的时候where后面跟的查询条件是school_id=’xx’ and major_id=’xx’，表里面有4万多条数据，执行起来非常慢，最快需要2s。</p>
<p>解决：</p>
<p>将school_id跟major_id设置成唯一索引（普通索引也可以），总之就是把这两列作为联合索引就行。之后执行飞快，基本上几毫秒就ok。</p>
<p><strong>1.添加PRIMARY KEY（主键索引）</strong> </p>
<p>mysql&gt;ALTER TABLE <code>table_name</code> ADD PRIMARY KEY ( <code>column</code> )</p>
<p><strong>2.添加UNIQUE(唯一索引)</strong><br>mysql&gt;ALTER TABLE <code>table_name</code> ADD UNIQUE ( <code>column</code> ) </p>
<p><strong>3.添加INDEX(普通索引)</strong> </p>
<p>mysql&gt;ALTER TABLE <code>table_name</code> ADD INDEX index_name ( <code>column</code> ) </p>
<p><strong>4.添加FULLTEXT(全文索引)</strong> </p>
<p>mysql&gt;ALTER TABLE <code>table_name</code> ADD FULLTEXT ( <code>column</code>) </p>
<p><strong>5.添加多列索引</strong><br>mysql&gt;ALTER TABLE <code>table_name</code> ADD INDEX index_name ( <code>column1</code>, <code>column2</code>, <code>column3</code> )</p>
<p>索引操作参考：</p>
<p><a href="https://www.w3cschool.cn/mysql/mysql-index.html" target="_blank" rel="noopener">https://www.w3cschool.cn/mysql/mysql-index.html</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2020/03/18/mysql添加索引解决速度问题/" data-id="ckfouenqh003u3quq6b8qi689" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Mysql/">Mysql</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-oss" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2020/03/13/oss/" class="article-date">
  <time datetime="2020-03-13T10:10:34.000Z" itemprop="datePublished">2020-03-13</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2020/03/13/oss/">oss</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p><a href="https://help.aliyun.com/document_detail/61872.html?spm=a2c4g.11174283.6.693.7c387da2cXcmsY" target="_blank" rel="noopener">https://help.aliyun.com/document_detail/61872.html?spm=a2c4g.11174283.6.693.7c387da2cXcmsY</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2020/03/13/oss/" data-id="ckfouenqi003w3quq3ukkw7ga" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-python解析html" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2020/03/10/python解析html/" class="article-date">
  <time datetime="2020-03-10T08:57:34.000Z" itemprop="datePublished">2020-03-10</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2020/03/10/python解析html/">python解析html</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>BeautifulSoup4文档:</p>
<p><a href="https://beautifulsoup.readthedocs.io/zh_CN/v4.4.0/" target="_blank" rel="noopener">https://beautifulsoup.readthedocs.io/zh_CN/v4.4.0/</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2020/03/10/python解析html/" data-id="ckfouenql00403quq6d2vuefx" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-Charles-抓包" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2020/03/10/Charles-抓包/" class="article-date">
  <time datetime="2020-03-10T07:44:16.000Z" itemprop="datePublished">2020-03-10</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2020/03/10/Charles-抓包/">Charles 抓包</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h4 id="报错：Charles-cannot-configure-your-proxy-settings-while-it-is-on-a-read-only-volume"><a href="#报错：Charles-cannot-configure-your-proxy-settings-while-it-is-on-a-read-only-volume" class="headerlink" title="报错：Charles cannot configure your proxy settings while it is on a read-only volume."></a>报错：Charles cannot configure your proxy settings while it is on a read-only volume.</h4><p>解决方法：</p>
<p>在Mac终端中输入</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo chown -R root &quot;/Applications/Charles.app/Contents/Resources&quot;</span><br><span class="line">sudo chmod -R u+s &quot;/Applications/Charles.app/Contents/Resources&quot;</span><br></pre></td></tr></table></figure>
<h4 id="Android-studio：connect-refuse"><a href="#Android-studio：connect-refuse" class="headerlink" title="Android studio：connect refuse"></a>Android studio：connect refuse</h4><p><a href="https://www.jianshu.com/p/89872a0ee16f" target="_blank" rel="noopener">https://www.jianshu.com/p/89872a0ee16f</a></p>
<p>AndroidStudio同步文件时同步失败，查找是不是开了代理，在AndroidStudio的Proxy中看到了这个提示，但是找到gradle.properties并没有这句话，一翻查找后找到了解决方案：</p>
<ul>
<li>命令行中输入<br> <code>JAVA_OPTS=&quot;$JAVA_OPTS -DsocksProxyPort&quot;</code></li>
<li>AndoridStudio中InvalidaCaches/Restart</li>
</ul>
<p>参考链接：<a href="https://links.jianshu.com/go?to=https%3A%2F%2Fstackoverflow.com%2Fquestions%2F35520337%2Fhow-to-remove-jvm-property-https-proxyhost" target="_blank" rel="noopener">https://stackoverflow.com/questions/35520337/how-to-remove-jvm-property-https-proxyhost</a></p>
<p>经常开Charls代理或者vpn的时容易出现这种情况。记录一下，以后好找。</p>
<h4 id="参考文旦"><a href="#参考文旦" class="headerlink" title="参考文旦"></a>参考文旦</h4><p><a href="https://blog.csdn.net/shadowyspirits/article/details/79756274" target="_blank" rel="noopener">https://blog.csdn.net/shadowyspirits/article/details/79756274</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2020/03/10/Charles-抓包/" data-id="ckfouenoa00183quqx1izh7uz" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-spring-boot-log-配置" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2020/03/05/spring-boot-log-配置/" class="article-date">
  <time datetime="2020-03-05T04:59:01.000Z" itemprop="datePublished">2020-03-05</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2020/03/05/spring-boot-log-配置/">spring boot log 配置</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>​    使用log4j2</p>
<h5 id="Q1-过滤掉系统日志？？"><a href="#Q1-过滤掉系统日志？？" class="headerlink" title="Q1:过滤掉系统日志？？"></a>Q1:过滤掉系统日志？？</h5><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">loggers</span>&gt;</span></span><br><span class="line">       <span class="comment">&lt;!-- 过滤掉org.springframework包下面的日志--&gt;</span></span><br><span class="line">  			<span class="comment">&lt;!-- name对应代码的包 additivity设置为false表示不会到root的log里面 --&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">logger</span> <span class="attr">name</span>=<span class="string">"org.springframework"</span> <span class="attr">level</span>=<span class="string">"INFO"</span> <span class="attr">additivity</span>=<span class="string">"false"</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;/<span class="name">logger</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">root</span> <span class="attr">level</span>=<span class="string">"INFO"</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">appender-ref</span> <span class="attr">ref</span>=<span class="string">"Console"</span>/&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">appender-ref</span> <span class="attr">ref</span>=<span class="string">"RollingFileInfo"</span>/&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">appender-ref</span> <span class="attr">ref</span>=<span class="string">"RollingFileWarn"</span>/&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">appender-ref</span> <span class="attr">ref</span>=<span class="string">"RollingFileError"</span>/&gt;</span></span><br><span class="line">       <span class="tag">&lt;/<span class="name">root</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">loggers</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h5 id="Q2-不同级别的日志输出到不同的文件？？"><a href="#Q2-不同级别的日志输出到不同的文件？？" class="headerlink" title="Q2: 不同级别的日志输出到不同的文件？？"></a>Q2: 不同级别的日志输出到不同的文件？？</h5><p><a href="https://github.com/bycuimiao/springboot2-log4j2-demo/blob/master/src/main/resources/log4j2.xml" target="_blank" rel="noopener">https://github.com/bycuimiao/springboot2-log4j2-demo/blob/master/src/main/resources/log4j2.xml</a></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">RollingFile</span> <span class="attr">name</span>=<span class="string">"RollingFileInfo"</span> <span class="attr">fileName</span>=<span class="string">"$&#123;FILE_PATH&#125;/info.log"</span></span></span><br><span class="line"><span class="tag">             <span class="attr">filePattern</span>=<span class="string">"$&#123;FILE_PATH&#125;/$&#123;FILE_NAME&#125;-INFO-%d&#123;yyyy-MM-dd&#125;_%i.log.gz"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">Filters</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 表示对于warn以及warn级别以上的日志 deny，对于warn一下子的日志不拦截 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">ThresholdFilter</span> <span class="attr">level</span>=<span class="string">"WARN"</span> <span class="attr">onMatch</span>=<span class="string">"DENY"</span> <span class="attr">onMismatch</span>=<span class="string">"NEUTRAL"</span>/&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 表示info以及以上的日志接受，以下的deny掉 （因为info的以上的日志都被上面的filter过滤掉了，所以只有info的日志可以通过这两个filter）--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">ThresholdFilter</span> <span class="attr">level</span>=<span class="string">"INFO"</span> <span class="attr">onMatch</span>=<span class="string">"ACCEPT"</span> <span class="attr">onMismatch</span>=<span class="string">"DENY"</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">Filters</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">PatternLayout</span> <span class="attr">pattern</span>=<span class="string">"$&#123;LOG_PATTERN&#125;"</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">Policies</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">SizeBasedTriggeringPolicy</span> <span class="attr">size</span>=<span class="string">"1M"</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">Policies</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">RollingFile</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">RollingFile</span> <span class="attr">name</span>=<span class="string">"RollingFileWarn"</span> <span class="attr">fileName</span>=<span class="string">"$&#123;FILE_PATH&#125;/warn.log"</span></span></span><br><span class="line"><span class="tag">             <span class="attr">filePattern</span>=<span class="string">"$&#123;FILE_PATH&#125;/$&#123;FILE_NAME&#125;-WARN-%d&#123;yyyy-MM-dd&#125;_%i.log.gz"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">Filters</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">ThresholdFilter</span> <span class="attr">level</span>=<span class="string">"ERROR"</span> <span class="attr">onMatch</span>=<span class="string">"DENY"</span> <span class="attr">onMismatch</span>=<span class="string">"NEUTRAL"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">ThresholdFilter</span> <span class="attr">level</span>=<span class="string">"WARN"</span> <span class="attr">onMatch</span>=<span class="string">"ACCEPT"</span> <span class="attr">onMismatch</span>=<span class="string">"DENY"</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">Filters</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">PatternLayout</span> <span class="attr">pattern</span>=<span class="string">"$&#123;LOG_PATTERN&#125;"</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">Policies</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">SizeBasedTriggeringPolicy</span> <span class="attr">size</span>=<span class="string">"1M"</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">Policies</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">RollingFile</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">RollingFile</span> <span class="attr">name</span>=<span class="string">"RollingFileError"</span> <span class="attr">fileName</span>=<span class="string">"$&#123;FILE_PATH&#125;/error.log"</span></span></span><br><span class="line"><span class="tag">             <span class="attr">filePattern</span>=<span class="string">"$&#123;FILE_PATH&#125;/$&#123;FILE_NAME&#125;-ERROR-%d&#123;yyyy-MM-dd&#125;_%i.log.gz"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">ThresholdFilter</span> <span class="attr">level</span>=<span class="string">"ERROR"</span> <span class="attr">onMatch</span>=<span class="string">"ACCEPT"</span> <span class="attr">onMismatch</span>=<span class="string">"DENY"</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">PatternLayout</span> <span class="attr">pattern</span>=<span class="string">"$&#123;LOG_PATTERN&#125;"</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">Policies</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">SizeBasedTriggeringPolicy</span> <span class="attr">size</span>=<span class="string">"1M"</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">Policies</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">RollingFile</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h5 id="Q3-不同环境日志文件位置问题？？"><a href="#Q3-不同环境日志文件位置问题？？" class="headerlink" title="Q3:不同环境日志文件位置问题？？"></a>Q3:不同环境日志文件位置问题？？</h5><p>对于日志的位置，不能使用绝对路径，原因是多人开发，每个人机器上的路径不一致，这个时候可以使用</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"FILE_PATH"</span> <span class="attr">value</span>=<span class="string">"$&#123;sys:user.home&#125;/home/logs"</span>/&gt;</span></span><br></pre></td></tr></table></figure>
<p>${sys:user.home}表示用户的目录，cd ～</p>
<p>在docker容器中对应/root 目录</p>
<h5 id="Q4-日志打印"><a href="#Q4-日志打印" class="headerlink" title="Q4:日志打印"></a>Q4:日志打印</h5><p>利用servelet拦截器</p>
<p><a href="https://www.jianshu.com/p/afdd31bfbf94" target="_blank" rel="noopener">https://www.jianshu.com/p/afdd31bfbf94</a></p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.lingshiedu.lszy.filter</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.slf4j.LoggerFactory</span><br><span class="line"><span class="keyword">import</span> org.slf4j.MDC</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.util.ContentCachingRequestWrapper</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.util.ContentCachingResponseWrapper</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.util.WebUtils</span><br><span class="line"><span class="keyword">import</span> java.io.UnsupportedEncodingException</span><br><span class="line"><span class="keyword">import</span> java.nio.charset.Charset</span><br><span class="line"><span class="keyword">import</span> java.util.*</span><br><span class="line"><span class="keyword">import</span> javax.servlet.*</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse</span><br><span class="line"></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">LogFilter</span> : <span class="type">Filter &#123;</span></span></span><br><span class="line">    <span class="keyword">val</span> Logger = LoggerFactory.getLogger(LogFilter::<span class="class"><span class="keyword">class</span>.<span class="title">java</span>)</span></span><br><span class="line">    <span class="keyword">val</span> SPLIT_STRING_M = <span class="string">"="</span></span><br><span class="line">    <span class="keyword">val</span> SPLIT_STRING_DOT = <span class="string">", "</span></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">destroy</span><span class="params">()</span></span> &#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">doFilter</span><span class="params">(req: <span class="type">ServletRequest</span>?, res: <span class="type">ServletResponse</span>?, filterChain: <span class="type">FilterChain</span>?)</span></span> &#123;</span><br><span class="line">        <span class="keyword">val</span> request = req <span class="keyword">as</span> HttpServletRequest</span><br><span class="line">        <span class="keyword">val</span> response = res <span class="keyword">as</span> HttpServletResponse</span><br><span class="line">        MDC.clear()</span><br><span class="line">        <span class="comment">//给本次请求分配一个唯一的tradeId</span></span><br><span class="line">        MDC.put(<span class="string">"trade_id"</span>, UUID.randomUUID().toString().replace(<span class="string">"-"</span>, <span class="string">""</span>))</span><br><span class="line"></span><br><span class="line">        <span class="keyword">val</span> wrapperRequest = ContentCachingRequestWrapper(request)</span><br><span class="line">        <span class="keyword">val</span> wrapperResponse = ContentCachingResponseWrapper(response)</span><br><span class="line"></span><br><span class="line">        Logger.info(<span class="string">"method[&#123;&#125;] | queryUrl[&#123;&#125;] | headers[&#123;&#125;] | queryParams[&#123;&#125;] | body:&#123;&#125;"</span>, request.method, request.requestURL, getHeaders(req), getRequestParams(request), getRequestBody(wrapperRequest))</span><br><span class="line">        filterChain!!.doFilter(wrapperRequest, wrapperResponse)</span><br><span class="line">        Logger.info(<span class="string">"resp body:&#123;&#125;"</span>, getResponseBody(wrapperResponse))</span><br><span class="line"></span><br><span class="line">        wrapperResponse.copyBodyToResponse()</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="function"><span class="keyword">fun</span> <span class="title">getRequestBody</span><span class="params">(request: <span class="type">ContentCachingRequestWrapper</span>)</span></span>: String? &#123;</span><br><span class="line">        <span class="keyword">val</span> wrapper = WebUtils.getNativeRequest(request, ContentCachingRequestWrapper::<span class="class"><span class="keyword">class</span>.<span class="title">java</span>)</span></span><br><span class="line">        <span class="keyword">if</span> (wrapper != <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">val</span> buf = wrapper.contentAsByteArray</span><br><span class="line">            <span class="keyword">if</span> (buf.isNotEmpty()) &#123;</span><br><span class="line">                <span class="keyword">val</span> payload: String = <span class="keyword">try</span> &#123;</span><br><span class="line">                    String(buf, <span class="number">0</span>, buf.size, Charset.forName(wrapper.characterEncoding))</span><br><span class="line">                &#125; <span class="keyword">catch</span> (e: UnsupportedEncodingException) &#123;</span><br><span class="line">                    <span class="string">"[unknown]"</span></span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                <span class="keyword">return</span> payload.replace(<span class="string">"\\n"</span>.toRegex(), <span class="string">""</span>)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="string">""</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="function"><span class="keyword">fun</span> <span class="title">getHeaders</span><span class="params">(req: <span class="type">HttpServletRequest</span>)</span></span>: String? &#123;</span><br><span class="line">        <span class="keyword">var</span> header = <span class="string">""</span></span><br><span class="line">        <span class="keyword">for</span> (key <span class="keyword">in</span> req.headerNames) &#123;</span><br><span class="line">            <span class="keyword">val</span> value = req.getHeader(key)</span><br><span class="line">            header += <span class="string">" [key:<span class="subst">$&#123;key&#125;</span> value:<span class="subst">$&#123;value&#125;</span>] "</span></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> header</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="function"><span class="keyword">fun</span> <span class="title">getResponseBody</span><span class="params">(response: <span class="type">ContentCachingResponseWrapper</span>)</span></span>: String? &#123;</span><br><span class="line">        <span class="keyword">val</span> wrapper = WebUtils.getNativeResponse(response, ContentCachingResponseWrapper::<span class="class"><span class="keyword">class</span>.<span class="title">java</span>)</span></span><br><span class="line">        <span class="keyword">if</span> (wrapper != <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">val</span> buf = wrapper.contentAsByteArray</span><br><span class="line">            <span class="keyword">if</span> (buf.isNotEmpty()) &#123;</span><br><span class="line">                <span class="keyword">val</span> payload: String = <span class="keyword">try</span> &#123;</span><br><span class="line">                    String(buf, <span class="number">0</span>, buf.size, Charset.forName(wrapper.characterEncoding))</span><br><span class="line">                &#125; <span class="keyword">catch</span> (e: UnsupportedEncodingException) &#123;</span><br><span class="line">                    <span class="string">"[unknown]"</span></span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                <span class="keyword">return</span> payload</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="string">""</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">fun</span> <span class="title">getRequestParams</span><span class="params">(request: <span class="type">HttpServletRequest</span>)</span></span>: String? &#123;</span><br><span class="line">        <span class="keyword">val</span> sb = StringBuilder()</span><br><span class="line">        <span class="keyword">val</span> enu = request.parameterNames</span><br><span class="line">        <span class="comment">//获取请求参数</span></span><br><span class="line">        <span class="keyword">while</span> (enu.hasMoreElements()) &#123;</span><br><span class="line">            <span class="keyword">val</span> name = enu.nextElement()</span><br><span class="line">            sb.append(name + SPLIT_STRING_M).append(request.getParameter(name))</span><br><span class="line">            <span class="keyword">if</span> (enu.hasMoreElements()) &#123;</span><br><span class="line">                sb.append(SPLIT_STRING_DOT)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> sb.toString()</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">init</span><span class="params">(p0: <span class="type">FilterConfig</span>?)</span></span> &#123;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2020/03/05/spring-boot-log-配置/" data-id="ckfouenqo00453quqlf4jc38h" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-docker" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2020/03/04/docker/" class="article-date">
  <time datetime="2020-03-04T11:49:42.000Z" itemprop="datePublished">2020-03-04</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2020/03/04/docker/">docker</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="入门"><a href="#入门" class="headerlink" title="入门"></a>入门</h3><h4 id="虚拟化技术"><a href="#虚拟化技术" class="headerlink" title="虚拟化技术"></a>虚拟化技术</h4><p>主要目的：可以在一个物理设备上做到环境<em>隔离</em></p>
<h5 id="主机级别虚拟化"><a href="#主机级别虚拟化" class="headerlink" title="主机级别虚拟化"></a>主机级别虚拟化</h5><p>两种类型</p>
<ul>
<li>在裸（物理）机上装hostOs，之后在hostOs上hypervisor（eg：vmware），之后在hypervisor上装各种系统</li>
<li>在裸（物理）机上直接装hypervisor，之后在hypervisor上装各种系统</li>
</ul>
<p><img src="https://timgsa.baidu.com/timg?image&amp;quality=80&amp;size=b9999_10000&amp;sec=1583476452667&amp;di=a41943c55bea90dd6eaa3ebbeec33adf&amp;imgtype=jpg&amp;src=http%3A%2F%2Fimg2.imgtn.bdimg.com%2Fit%2Fu%3D623266907%2C3100268360%26fm%3D214%26gp%3D0.jpg" alt="img"></p>
<p>假设需要运行一个web服务，为此我们必须先安装hypervisor，再安装系统，之后在系统上安装nginx或者tomcat；</p>
<p>如果是第一种类型，使用物理资源还需要经过两个内核的调度，这样开销是比较大的。</p>
<h5 id="容器级别虚拟化"><a href="#容器级别虚拟化" class="headerlink" title="容器级别虚拟化"></a>容器级别虚拟化</h5><p>linux分为内核跟用户空间，linux内核有两个功能：</p>
<ul>
<li>namespace</li>
<li>cgroup</li>
</ul>
<p>通过这两个功能，linux可以做到对用户空间的隔离。这些隔离的用户空间就是容器。</p>
<p>每一个虚拟机都有自己的ip，域名，文件系统等等，一个主机有的它基本都有。</p>
<p>容器也需要有独立的：</p>
<ul>
<li>主机名：域名</li>
<li>文件系统</li>
<li>进程通信ipc</li>
<li>进程id（pid）</li>
<li>用户组</li>
<li>net（ip地址，端口，等）</li>
</ul>
<p>这个就是通过命名空间（namespace）实现的；自己理解可以类比写代码时的namespace（相同的类名在不同的namespace下是隔离的）</p>
<p>然而不同namespace之间物理资源（更多是硬件资源，cpu，内存等）还是相互竞争的。仍然需要管理每个container可以使用的资源。cgroups 实现了对资源的配额和度量，通过它我们可以实现资源的隔离分配。</p>
<h4 id="docker"><a href="#docker" class="headerlink" title="docker"></a>docker</h4><p>容器级别虚拟化相对主机级别虚拟化</p>
<ul>
<li>开销小，因为直接运行在宿主机上</li>
<li>隔离性上差点意思</li>
</ul>
<p>这两种虚拟化技术都有一个问题：迁移性。</p>
<p>docker利用镜像跟仓库很好的解决了这个问题。</p>
<p>有了docker之后我们可以一次编写到处运行，只要安装了docker，这一点跟jvm挺像的。</p>
<p>最大的优点：分发部署</p>
<h3 id="Docker基本用法"><a href="#Docker基本用法" class="headerlink" title="Docker基本用法"></a>Docker基本用法</h3><h4 id="docker架构图"><a href="#docker架构图" class="headerlink" title="docker架构图"></a>docker架构图</h4><p><img src="https://timgsa.baidu.com/timg?image&amp;quality=80&amp;size=b9999_10000&amp;sec=1583472581256&amp;di=b4ff5c940beec76f50ad74ca4290a0bc&amp;imgtype=jpg&amp;src=http%3A%2F%2Fimg.dongcoder.com%2Fup%2Finfo%2F201807%2F20180715132007371540.png" alt="img"></p>
<p>c/s架构，使用远程api的方式管理跟创建Docker容器。</p>
<ol>
<li><p>dockerClient</p>
<p>类似postman，可以发送get，post，put等等各种请求给host，通过api的方式增删改查image跟container</p>
</li>
<li><p>dockerHost</p>
<ul>
<li>dockerDeamon：用来监听套接字，一般在宿主主机的后台运行，等待接受客户端的请求（docker命令），类比服务端程序。</li>
<li>image： 用来生成容器的<ul>
<li>只读的</li>
<li>分层构建的（可以通过dockerFile理解）,可以根据自己的需求在已有得镜像的基础上随意扩展</li>
<li>静态的</li>
</ul>
</li>
<li>container：隔离的用户空间，一个独立于主机的隔离的进程，由image创建</li>
</ul>
</li>
<li><p>Registry</p>
<p>主要功能是作为repository存放image，docker官方提供了dockerhub，但是服务器在国外，访问比较慢，在国内也提供了，但是也不快。可以使用阿里或者科大或者清华的镜像仓库。个人配置的是阿里的，体验挺好的（需要注册一个阿里账户，之后会分配一个地址）。</p>
<p>阿里镜像加速：<a href="https://cr.console.aliyun.com/cn-hangzhou/instances/mirrors" target="_blank" rel="noopener">https://cr.console.aliyun.com/cn-hangzhou/instances/mirrors</a></p>
</li>
</ol>
<p>image跟container的关系：类似程序跟进程的关系，类似class跟实体的关系</p>
<h4 id="流程"><a href="#流程" class="headerlink" title="流程"></a>流程</h4><p>在终端输入 docker container create –name n3 nginx，</p>
<ol>
<li>host的deamon收到请求（http的方式）</li>
<li>在本地检查是否有nginx镜像</li>
<li>如果有，那么根据镜像创建n3容器</li>
<li>如果么有，那么发请求到（https）registry中拉去nginx镜像到本地，之后在本地创建n3容器</li>
</ol>
<h4 id="常用命令"><a href="#常用命令" class="headerlink" title="常用命令"></a>常用命令</h4><h5 id="docker-1"><a href="#docker-1" class="headerlink" title="docker"></a>docker</h5><ul>
<li>docker verison</li>
<li>docker info  （镜像加速配置完之后可以通过它来查看是否配置成功了）</li>
<li>docker search  镜像名  ：dockerhub上查找镜像</li>
<li>docker inspect 容器名或者镜像名      ：  查看容器或者镜像的详细信息（可以查看容器的ip地址，挂载信息等等）</li>
<li>docker exec -it 容器名 /bin/bash ：  进入容器终端</li>
<li>docker logs 容器名  </li>
<li>docker cp 容器名:容器文件或文件夹  宿主机文件或文件夹   ：将容器中的文件或文件夹复制出来</li>
<li>docker tag  给镜像打标签</li>
<li>docker commit  通过容器创建镜像</li>
</ul>
<h5 id="image"><a href="#image" class="headerlink" title="image"></a>image</h5><ul>
<li>docker image pull 镜像名:tag     ： 拉取镜像，tag可以缺省</li>
<li>docker image ls   : 查看所有的镜像</li>
<li>docker image rm 镜像名  ：删除镜像</li>
</ul>
<h5 id="container"><a href="#container" class="headerlink" title="container"></a>container</h5><ul>
<li><p>docker container ls -a         : 查看所有容器</p>
</li>
<li><p>docker container ls -s         : 可以查看容器的size</p>
</li>
<li><p>docker container create –name n1 nginx  :创建nginx容器n1</p>
</li>
<li><p>docker container start n1    ：启动n1</p>
</li>
<li><p>docker container stop xxx  ：停止容器</p>
</li>
<li><p>docker container rm xxx  ：删除stop的容器</p>
</li>
<li><p>docker container run -it –name n2 nginx  /bin/bash   :创建并启动nginx容器n2，并进入容器终端</p>
</li>
<li><p>doker container  run -it –name xxx  –rm   -v   xxx1:xxx2  镜像名 /bin/bash </p>
<ul>
<li>it：可以交互的终端</li>
<li>rm：运行完自动删除</li>
<li>d：  运行在后台</li>
<li>name xxx： 容器名</li>
<li>v : 文件挂载    主机的xxx1挂载到容器的xxx2</li>
</ul>
</li>
</ul>
<h5 id="tip"><a href="#tip" class="headerlink" title="tip"></a>tip</h5><ul>
<li>Netstat -tnl  查看监听的端口</li>
</ul>
<h3 id="Docker-镜像管理基础"><a href="#Docker-镜像管理基础" class="headerlink" title="Docker 镜像管理基础"></a>Docker 镜像管理基础</h3><p>镜像就是把业务代码，可运行环境进行整体的打包。</p>
<p>镜像包含了启动容器需要的文件系统跟其他内容，因此，镜像用来创建并启动容器。</p>
<p>参考：<a href="https://zhuanlan.zhihu.com/p/70424048" target="_blank" rel="noopener">https://zhuanlan.zhihu.com/p/70424048</a></p>
<h4 id="思考题"><a href="#思考题" class="headerlink" title="思考题"></a>思考题</h4><ul>
<li>我们基于同一个镜像（ubuntu 18.4）启动了两个容器，会占用两倍磁盘空间吗？</li>
<li>我们在容器内修改或者新建了某个文件，要修改原镜像吗？</li>
<li>我们基于某镜像（ubuntu 18.04）新建一个镜像（myubuntu），需要将原镜像文件全部拷贝到新镜像中吗？</li>
</ul>
<p>首先，让我们尝试思考下，如果我们去做，该如何高效的解决这些问题？</p>
<ul>
<li>问题 1，只要将同一个镜像文件加载到内存不同位置就行了，没必要在磁盘上存储多份，可以节省大量存储空间。</li>
<li>问题 2，我们可以参考 Linux 内核管理内存的 <em>Copy-On-Write 策略，也即读时大家共用一份文件，如果需要修改再复制一份进行修改，而大部分文件是其实不会修改的，这样可以最大限度节省空间，提升性能。</em></li>
<li>问题 3，我们可以将镜像文件分为多个独立的层，然后新镜像文件只要引用基础镜像文件就可以了，这样可以节省大量空间。至于修改基础镜像文件的情况，参考问题 2 </li>
</ul>
<h4 id="镜像分层"><a href="#镜像分层" class="headerlink" title="镜像分层"></a>镜像分层</h4><p><img src="https://ss1.bdstatic.com/70cFvXSh_Q1YnxGkpoWK1HF6hhy/it/u=113669502,2763591295&amp;fm=26&amp;gp=0.jpg" alt="img"></p>
<ol>
<li>镜像分层，除了最上层的容器层是可读写的，其他层都是只读的。如果容器层需要读写其他层的数据，需要用到copy-on-write技术</li>
<li>只读层是可以共享的</li>
<li>每个容器都有自己的读写层，容器被删之后读写层也会被删除。如果想要持久化数据，可以使用docker挂载（volume）：比如log日志</li>
<li>执行docker ps -s（或者docker container ls -s）可以看到容器最后一列有个size（2B (virtual 127MB)），这里的2B就是读写层的大小，127M是读写层加只读层的大小。</li>
</ol>
<h5 id="UnionFS"><a href="#UnionFS" class="headerlink" title="UnionFS"></a>UnionFS</h5><p>docker可以实现分层依赖的就是unionFs，所谓 UnionFS 就是把不同物理位置的目录合并到同一个目录中。对应docker，就是把下层的文件“合并”到上层，如果在上层想要修改下层的文件，需要先把下层文件copy到上层，之后再修改，但是下层的文件是不变的。</p>
<p>14年的时候linux内核中合并了overlayFs，也是现在docker使用的存储方案，执行docker info可以看到。</p>
<p><a href="https://zhuanlan.zhihu.com/p/70424048" target="_blank" rel="noopener">https://zhuanlan.zhihu.com/p/70424048</a> 这篇文章中使用mount命令在ubuntu中模拟了docker的分层。</p>
<h4 id="镜像构建分发"><a href="#镜像构建分发" class="headerlink" title="镜像构建分发"></a>镜像构建分发</h4><h5 id="构建"><a href="#构建" class="headerlink" title="构建"></a>构建</h5><ol>
<li><p>通过容器构建</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker commit -p m1 kj/mysql:v1</span><br></pre></td></tr></table></figure>
<ul>
<li>-p   暂停容器</li>
<li>m1  容器名</li>
<li>kj/mysql  镜像仓库名</li>
<li>v1   镜像版本</li>
</ul>
</li>
<li><p>通过dockerfile构建</p>
<ul>
<li>可以跟github，docker仓库（阿里云或者dockerhub）联动</li>
</ul>
</li>
</ol>
<ul>
<li>上传dockerFile到github，docker仓库检测到dockerfile的变化，会去github上拉代码然后build好镜像<ul>
<li>底层也是基于容器构建的，只不过是docker帮我们新建了一个容器，dockerfile实际是在这个容器里面执行的</li>
</ul>
</li>
</ul>
<h5 id="分发"><a href="#分发" class="headerlink" title="分发"></a>分发</h5><ol>
<li><p>上传到仓库分发</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">docker login </span><br><span class="line">docker push</span><br></pre></td></tr></table></figure>
<ul>
<li>Dockerhub镜像的仓库名必须跟hub上的一致</li>
<li>阿里云</li>
</ul>
</li>
<li><p>本地打包分发</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">docker save</span><br><span class="line">docker load</span><br></pre></td></tr></table></figure>
</li>
</ol>
<h3 id="容器虚拟网络"><a href="#容器虚拟网络" class="headerlink" title="容器虚拟网络"></a>容器虚拟网络</h3><h4 id="基本概念"><a href="#基本概念" class="headerlink" title="基本概念"></a>基本概念</h4><p>Linux内核支持二层以及三层设备的虚拟化。</p>
<ol>
<li><p>虚拟网卡</p>
<ul>
<li><p>linux内核支持虚拟网卡的创建（ip命令）</p>
</li>
<li><p>每一个虚拟网卡是成对出现的，可以模拟成一根网线（下图中的eth0跟veth就是虚拟网卡的两端）</p>
</li>
</ul>
<p>作用：连接虚拟网桥跟容器</p>
</li>
<li><p>虚拟网桥（交换机）</p>
<ul>
<li><p>Docker0</p>
</li>
<li><p>ip，mac映射</p>
</li>
<li><p>linux内核也支持虚拟交换机的创建（brctl 命令）</p>
</li>
<li><p>通过交换机，同一个网段不同的容器可以通信</p>
</li>
</ul>
<p>作用：将主机以及所有的容器放在同一个局域网内</p>
</li>
<li><p>nat</p>
<p>网络地址转化</p>
<p>作用</p>
<ul>
<li><p>将容器的私有地址转化为物理网卡的地址（snat）</p>
</li>
<li><p>将物理网卡的地址转化为容器的地址（dnat）</p>
</li>
</ul>
</li>
</ol>
<h4 id="docker的四种网络模式"><a href="#docker的四种网络模式" class="headerlink" title="docker的四种网络模式"></a>docker的四种网络模式</h4><h5 id="bridge"><a href="#bridge" class="headerlink" title="bridge"></a>bridge</h5><p>当Docker进程启动时，会在主机上创建一个名为docker0的虚拟网桥，此主机上启动的Docker容器会连接到这个虚拟网桥上。虚拟网桥的工作方式和物理交换机类似，这样主机上的所有容器就通过交换机连在了一个二层网络中。</p>
<p>从docker0子网中分配一个IP给容器使用，并设置docker0的IP地址为容器的默认网关。在主机上创建一对虚拟网卡veth pair设备，Docker将veth pair设备的一端放在新创建的容器中，并命名为eth0（容器的网卡），另一端放在主机中，以vethxxx这样类似的名字命名，并将这个网络设备加入到docker0网桥中。可以通过brctl show命令查看。</p>
<p>bridge模式是docker的默认网络模式，不写–net参数，就是bridge模式。使用docker run -p时，docker实际是在iptables做了DNAT规则，实现端口转发功能。可以使用iptables -t nat -vnL查看</p>
<p><img src="https://timgsa.baidu.com/timg?image&amp;quality=80&amp;size=b9999_10000&amp;sec=1584465867957&amp;di=33802fb735f90368ba860b1b596ec3f2&amp;imgtype=0&amp;src=http%3A%2F%2Fpic4.zhimg.com%2Fv2-e67ade9faeaa9b8c1dbbd146e6d5444f_b.jpg" alt="img"></p>
<h5 id="host"><a href="#host" class="headerlink" title="host"></a>host</h5><p>如果启动容器的时候使用host模式，那么这个容器将不会获得一个独立的Network Namespace，而是和宿主机共用一个Network Namespace。容器将不会虚拟出自己的网卡，配置自己的IP等，而是使用宿主机的IP和端口。但是，容器的其他方面，如文件系统、进程列表等还是和宿主机隔离的。</p>
<h5 id="container-1"><a href="#container-1" class="headerlink" title="container"></a>container</h5><p>这个模式指定新创建的容器和已经存在的一个容器共享一个 Network Namespace，而不是和宿主机共享。新创建的容器不会创建自己的网卡，配置自己的 IP，而是和一个指定的容器共享 IP、端口范围等。同样，两个容器除了网络方面，其他的如文件系统、进程列表等还是隔离的。两个容器的进程可以通过 lo 网卡设备通信。</p>
<h5 id="none"><a href="#none" class="headerlink" title="none"></a>none</h5><p>使用none模式，Docker容器拥有自己的Network Namespace，但是，并不为Docker容器进行任何网络配置。也就是说，这个Docker容器没有网卡、IP、路由等信息。需要我们自己为Docker容器添加网卡、配置IP等。</p>
<h4 id="bridge模型验证"><a href="#bridge模型验证" class="headerlink" title="bridge模型验证"></a>bridge模型验证</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">[root@iZ2ze4qtfwa4w5rqbr2e83Z ~]<span class="comment"># ifconfig</span></span><br><span class="line"></span><br><span class="line">docker0: flags=4163&lt;UP,BROADCAST,RUNNING,MULTICAST&gt;  mtu 1500</span><br><span class="line"></span><br><span class="line">eth0: flags=4163&lt;UP,BROADCAST,RUNNING,MULTICAST&gt;  mtu 1500</span><br><span class="line"></span><br><span class="line">lo: flags=73&lt;UP,LOOPBACK,RUNNING&gt;  mtu 65536</span><br><span class="line"></span><br><span class="line">veth4c07805: flags=4163&lt;UP,BROADCAST,RUNNING,MULTICAST&gt;  mtu 1500</span><br><span class="line"></span><br><span class="line">veth718f748: flags=4163&lt;UP,BROADCAST,RUNNING,MULTICAST&gt;  mtu 1500</span><br><span class="line"></span><br><span class="line">vethce1977e: flags=4163&lt;UP,BROADCAST,RUNNING,MULTICAST&gt;  mtu 1500</span><br><span class="line"></span><br><span class="line">vethf87afa7: flags=4163&lt;UP,BROADCAST,RUNNING,MULTICAST&gt;  mtu 1500</span><br></pre></td></tr></table></figure>
<p>docker0就是虚拟网桥</p>
<p>vethxxx是虚拟网卡的一端，都是连接在docker0上的，使用brctl验证如下：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[root@iZ2ze4qtfwa4w5rqbr2e83Z ~]<span class="comment"># yum -y install bridge-utils</span></span><br><span class="line"></span><br><span class="line">[root@iZ2ze4qtfwa4w5rqbr2e83Z ~]<span class="comment"># brctl show</span></span><br><span class="line">bridge name			bridge id					STP enabled			interfaces</span><br><span class="line">docker0					8000.0242e24e01a3	no							veth4c07805</span><br><span class="line">																									veth718f748</span><br><span class="line">																									vethce1977e</span><br><span class="line">																									vethf87afa7</span><br></pre></td></tr></table></figure>
<p>验证网卡连接：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[root@iZ2ze4qtfwa4w5rqbr2e83Z ~]<span class="comment"># ip link show</span></span><br><span class="line">1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN mode DEFAULT group </span><br><span class="line">2: eth0: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc mq state UP mode DEFAULT group </span><br><span class="line">3: docker0: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc noqueue state UP mode DEFAULT </span><br><span class="line">5: vethce1977e@if4: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc noqueue master docker0 </span><br><span class="line">9: vethf87afa7@if8: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc noqueue master docker0 </span><br><span class="line">17: veth718f748@if16: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc noqueue master </span><br><span class="line">19: veth4c07805@if18: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc noqueue master</span><br></pre></td></tr></table></figure>
<p>5,9,17,19是4个网卡，以“vethce1977e@if4”为例，vethce1977e是连接在docker0上的，if4是放在容器上的。</p>
<p>进入容器查看网卡：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">wangzeqi@wangzeqideMacBook-Pro ~ % docker run -it --name b1 busybox /bin/sh</span><br><span class="line">/ <span class="comment"># ifconfig</span></span><br><span class="line">eth0      Link encap:Ethernet  HWaddr 02:42:AC:11:00:03</span><br><span class="line">          inet addr:172.17.0.3  Bcast:172.17.255.255  Mask:255.255.0.0</span><br><span class="line"></span><br><span class="line">lo        Link encap:Local Loopback</span><br><span class="line"></span><br><span class="line">/ <span class="comment"># ping 172.17.0.1</span></span><br><span class="line">PING 172.17.0.1 (172.17.0.1): 56 data bytes</span><br><span class="line">64 bytes from 172.17.0.1: seq=0 ttl=64 time=2.169 ms</span><br></pre></td></tr></table></figure>
<p>eth0就是虚拟网卡的另一端，ping 虚拟网桥docker0可以ping通。</p>
<p>nat：查看iptables规则</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@iZ2ze4qtfwa4w5rqbr2e83Z ~]<span class="comment"># iptables -t nat -vnL</span></span><br></pre></td></tr></table></figure>
<p>所有收到的源地址为172.18.0.0/16（除了docker0）目标地址为任意地址的请求，都做snat（局域网内部私有地址转化为主机物理网卡的地址） tip：  MASQUERADE的翻译是化妆，非常形象</p>
<p>主机端口通过dnat转发到容器端口</p>
<p>参考：</p>
<p><a href="https://www.cnblogs.com/yy-cxd/p/6553624.html" target="_blank" rel="noopener">https://www.cnblogs.com/yy-cxd/p/6553624.html</a></p>
<p><a href="https://blog.csdn.net/nia305/article/details/82775384" target="_blank" rel="noopener">https://blog.csdn.net/nia305/article/details/82775384</a></p>
<h4 id="tip-1"><a href="#tip-1" class="headerlink" title="tip"></a>tip</h4><p>Q：Docker For Mac没有docker0网桥</p>
<p>在使用Docker时，要注意平台之间实现的差异性，如Docker For Mac的实现和标准Docker规范有区别，Docker For Mac的Docker Daemon是运行于虚拟机(xhyve)中的, 而不是像Linux上那样作为进程运行于宿主机，因此Docker For Mac没有docker0网桥，不能实现host网络模式，host模式会使Container复用Daemon的网络栈(在xhyve虚拟机中)，而不是与Host主机网络栈，这样虽然其它容器仍然可通过xhyve网络栈进行交互，但却不是用的Host上的端口(在Host上无法访问)。bridge网络模式 -p 参数不受此影响，它能正常打开Host上的端口并映射到Container的对应Port。</p>
<h3 id="Docker存储卷"><a href="#Docker存储卷" class="headerlink" title="Docker存储卷"></a>Docker存储卷</h3><h4 id="写时复制"><a href="#写时复制" class="headerlink" title="写时复制"></a>写时复制</h4><ul>
<li>镜像是分层的，docker容器启动的时候会去加载镜像的只读层，然后在最上层添加一个读写层。</li>
<li>容器中的io都是针对读写层</li>
<li>如果要对只读层的内容进行修改或者删除，需要将只读层的内容copy到读写层，之后在读写层操作（tip：删除的话只是在读写层标记为删除）</li>
</ul>
<h4 id="概念"><a href="#概念" class="headerlink" title="概念"></a>概念</h4><p>考虑我们做一个mysql的容器</p>
<ol>
<li>数据读写都在容器中的读写层，存储效率低。</li>
<li>数据会随着容器的删除而丢失</li>
</ol>
<p>此时就需要存储卷</p>
<ol>
<li><strong>“宿主机上”</strong>有个存储目录A，容器有个存储目录B，把这两个目录关联起来，A跟B的内容始终是同步的。那么A就是存储卷。</li>
<li>在容器删除的时候数据不会丢失</li>
<li>两个容器可以通过这种方式通信</li>
<li>1中“宿主机”并不准确，这个目录也可以是共享目录，比如nfs服务器上的目录，这样容器就不用局限在一个宿主机上。</li>
</ol>
<h4 id="两种类型"><a href="#两种类型" class="headerlink" title="两种类型"></a>两种类型</h4><ol>
<li>绑定挂载卷：宿主机的目录跟容器的目录都是run的时候指定的</li>
<li>docker管理卷：容器中的目录是run的时候指定的，宿主机目录由docker deamon自动指定</li>
</ol>
<h4 id="演示"><a href="#演示" class="headerlink" title="演示"></a>演示</h4><ol>
<li>启动容器c1：关联宿主机目录/Users/wangzeqi/container/data 跟 容器目录/data</li>
<li>在/data目录下新建一个文件</li>
<li>删除容器c1，查看/Users/wangzeqi/container/data目录</li>
<li>启动容器c2，关联/Users/wangzeqi/container/data跟/data/temp，</li>
<li>查看/data/temp目录</li>
<li>查看容器信息</li>
</ol>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">1</span></span><br><span class="line">docker container run --name c1 --rm -it -v /Users/wangzeqi/container/data:/data busybox</span><br><span class="line"><span class="meta">#</span><span class="bash">2</span></span><br><span class="line">cd /data</span><br><span class="line">echo "hello" &gt;&gt; test.txt</span><br><span class="line"><span class="meta">#</span><span class="bash">3</span></span><br><span class="line">exit</span><br><span class="line">cd /Users/wangzeqi/container/data</span><br><span class="line">cat test.txt</span><br><span class="line"><span class="meta">#</span><span class="bash">4</span></span><br><span class="line">docker container run --name c2 --rm -it -v /Users/wangzeqi/container/data:/data/temp busybox</span><br><span class="line"><span class="meta">#</span><span class="bash">5</span></span><br><span class="line">cd data/temp/</span><br><span class="line">cat test.txt</span><br><span class="line"><span class="meta">#</span><span class="bash">6</span></span><br><span class="line">docker inspect c2</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">可以看到如下信息</span></span><br><span class="line">"Mounts": [</span><br><span class="line">  &#123;</span><br><span class="line">    "Type": "bind", #存储卷类型</span><br><span class="line">    "Source": "/Users/wangzeqi/container/data", # 宿主机目录</span><br><span class="line">    "Destination": "/data/temp", # 容器目录</span><br><span class="line">    "Mode": "",</span><br><span class="line">    "RW": true,  </span><br><span class="line">    "Propagation": "rprivate"</span><br><span class="line">  &#125;</span><br><span class="line">],</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">6 或者</span></span><br><span class="line">docker inspect -f &#123;&#123;.Mounts&#125;&#125; c2</span><br><span class="line"><span class="meta">#</span><span class="bash">打印如下</span></span><br><span class="line">[&#123;bind  /Users/wangzeqi/container/data /data/temp   true rprivate&#125;]</span><br></pre></td></tr></table></figure>
<h4 id="tip-2"><a href="#tip-2" class="headerlink" title="tip"></a>tip</h4><ol>
<li><p>-v的目录如果不存在docker会自动创建</p>
</li>
<li><p>两个容器可以共享一个存储卷</p>
<ul>
<li>–volumes-from c1   复制容器c1的挂载关联规则</li>
</ul>
</li>
<li><p>两个容器可以共享一个网络空间（docker网络模式中的container模式）</p>
<ul>
<li>–network container:c1  加入c1的网络空间</li>
</ul>
</li>
<li><p>为了不用每次都指定容器的网络配置或者挂载配置，假如需要搭建nmt （nginx ，tomcat，mysql ）架构或者更加复杂的，可以</p>
<ul>
<li>创建一个基础架构容器，新建其他容器的时候从基础架构容器复制配置信息</li>
<li>或者使用容器编排工具（docker-compose），这个也支持创建基础架构容器</li>
<li>或者使用k8s编排</li>
</ul>
</li>
</ol>
<h3 id="Dockerfile"><a href="#Dockerfile" class="headerlink" title="Dockerfile"></a>Dockerfile</h3><p>构建镜像的源码。镜像是分层的，dockerfile中每一条命令对应一层。</p>
<h4 id="工作逻辑"><a href="#工作逻辑" class="headerlink" title="工作逻辑"></a>工作逻辑</h4><ol>
<li><p>选定一个工作目录</p>
</li>
<li><p>工作目录下放Dockerfile文件</p>
</li>
<li><p>如果构建过程需要访问某个文件，那个这个文件必须在工作目录下</p>
</li>
<li><p>构建的时候工作目录下的文件都会打包到镜像。</p>
</li>
<li><p>.dockerignore文件中声明的文件不会打包到镜像</p>
</li>
</ol>
<h4 id="指令"><a href="#指令" class="headerlink" title="指令"></a>指令</h4><p>先看一个实例，看注释即可（以下是在node容器中构建ant design vue项目的dockerfile）</p>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 定义基础镜像</span></span><br><span class="line"><span class="keyword">FROM</span> node:<span class="number">13.11</span>.<span class="number">0</span></span><br><span class="line"><span class="comment"># install yarn</span></span><br><span class="line"><span class="keyword">RUN</span><span class="bash"> npm install -y yarn</span></span><br><span class="line"><span class="bash"><span class="comment"># 指定工作目录</span></span></span><br><span class="line"><span class="bash">WORKDIR /app/lszy_admin_web</span></span><br><span class="line"><span class="bash"><span class="comment"># 安装依赖</span></span></span><br><span class="line"><span class="bash">COPY package.json yarn.lock ./</span></span><br><span class="line"><span class="bash">RUN yarn install</span></span><br><span class="line"><span class="bash"><span class="comment"># 将工程copy到工作目录</span></span></span><br><span class="line"><span class="bash">COPY ./ ./</span></span><br><span class="line"><span class="bash"><span class="comment"># 声明build的arg，测试环境：build:test；正式环境：build</span></span></span><br><span class="line"><span class="bash">ARG env</span></span><br><span class="line"><span class="bash"><span class="comment"># build</span></span></span><br><span class="line"><span class="bash">RUN yarn <span class="variable">$&#123;env&#125;</span></span></span><br><span class="line"><span class="bash"><span class="comment"># 将dist复制到存储卷</span></span></span><br><span class="line"><span class="bash">CMD cp -rf dist dist_copy</span></span><br></pre></td></tr></table></figure>
<h5 id="FROM"><a href="#FROM" class="headerlink" title="FROM"></a>FROM</h5><ol>
<li>定义基础镜像</li>
<li>默认情况下build命令会先在本地查看是否有该基础镜像，没有的话会去dockerHub拉取（如果设置了阿里的镜像加速，那么会从加速地址去拉取）或者也可以指定拉取的地址（registry）</li>
<li>格式：镜像仓库名:tag  或者 镜像仓库名@digest ， 第二种更加安全</li>
</ol>
<h5 id="MAINTAINER"><a href="#MAINTAINER" class="headerlink" title="MAINTAINER"></a>MAINTAINER</h5><p>废弃了，设置作者信息</p>
<h5 id="LABLE"><a href="#LABLE" class="headerlink" title="LABLE"></a>LABLE</h5><ol>
<li>替代maintainer</li>
<li>key-value形式</li>
<li>用来设置说明信息，类似注释</li>
</ol>
<h5 id="COPY-amp-amp-ADD"><a href="#COPY-amp-amp-ADD" class="headerlink" title="COPY &amp;&amp; ADD"></a>COPY &amp;&amp; ADD</h5><ol>
<li>从文件或者文件夹复制到镜像的指定目录</li>
<li>ADD可以复制url，COPY只能复制宿主机的内容</li>
<li>ADD复制tar文件时，会自动解压，copy不会自动解压</li>
<li>一条命令中源文件可以有多个，目标文件只能一个</li>
<li>复制文件夹的时候是复制文件夹下所有内容，文件夹本身不会复制过去</li>
<li>目标文件必须“/”结尾</li>
</ol>
<h5 id="WORKDIR"><a href="#WORKDIR" class="headerlink" title="WORKDIR"></a>WORKDIR</h5><ol>
<li>指定容器启动之后的工作目录</li>
<li>容器启动之后默认会进入该目录</li>
<li>DockerFile中WORKDIR声明工作路径之后，下面所有命令中涉及到镜像中的路径时都可以使用相对该工作目录的相对路径</li>
</ol>
<h5 id="ARG-amp-amp-ENV"><a href="#ARG-amp-amp-ENV" class="headerlink" title="ARG &amp;&amp; ENV"></a>ARG &amp;&amp; ENV</h5><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">wangzeqi@wangzeqideMacBook-Pro workspace % docker build -t <span class="string">"test"</span> .</span><br><span class="line">Sending build context to Docker daemon   5.12kB</span><br><span class="line">Step 1/3 : FROM busybox</span><br><span class="line"> ---&gt; 6d5fcfe5ff17</span><br><span class="line">Step 2/3 : WORKDIR	/</span><br><span class="line"> ---&gt; Running <span class="keyword">in</span> 2630e64e0b23</span><br><span class="line">Removing intermediate container 2630e64e0b23</span><br><span class="line"> ---&gt; 70c2a25a7355</span><br><span class="line">Step 3/3 : RUN mkdir <span class="built_in">test</span> &amp;&amp;     <span class="built_in">cd</span> <span class="built_in">test</span> &amp;&amp;     <span class="built_in">echo</span> <span class="string">"hello"</span> &gt;&gt; test.txt</span><br><span class="line"> ---&gt; Running <span class="keyword">in</span> 91496fb114ae</span><br><span class="line">Removing intermediate container 91496fb114ae</span><br><span class="line"> ---&gt; ddd723329232</span><br><span class="line">Successfully built ddd723329232</span><br><span class="line">Successfully tagged <span class="built_in">test</span>:latest</span><br></pre></td></tr></table></figure>
<ol>
<li><p>使用dockerfile构建镜像的过程如上，（注意每一层执行之后都有一个removing操作）每一层都会新建一个临时容器，在容器上运行该层的命令，运行完成之后删除容器</p>
</li>
<li><p>ARG用于定义镜像构建时传递的参数：在构建的过程中如果我们需要动态的传递参数，那么可以使用ARG命令指定形参，在build的时候传递实参</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> Dockerfile</span></span><br><span class="line">ARG arg1</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 执行构建</span></span><br><span class="line">docker build --build-arg arg1=build:test . -t node_lszy_admin_web</span><br></pre></td></tr></table></figure>
</li>
<li><p>ENV则是定义容器运行时传递的参数</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Dockerfile</span></span><br><span class="line">ENV env1</span><br><span class="line"></span><br><span class="line"><span class="comment"># 运行容器</span></span><br><span class="line">docker run --name <span class="built_in">test</span> --rm --env env1=build <span class="built_in">test</span></span><br></pre></td></tr></table></figure>
</li>
</ol>
<h5 id="CMD-amp-amp-RUN"><a href="#CMD-amp-amp-RUN" class="headerlink" title="CMD &amp;&amp; RUN"></a>CMD &amp;&amp; RUN</h5><pre><code>1. CMD 是在容器启动之后默认执行的命令，如果我们在docker run 之后加了命令，那么dockerfile中的的cmd将会被替换掉
 2. RUN 是在构建镜像是执行的命令
</code></pre><h5 id="VOLOMN"><a href="#VOLOMN" class="headerlink" title="VOLOMN"></a>VOLOMN</h5><ol>
<li>定义容器中的存储卷</li>
<li>run的时候不需要使用-v指定存储卷的位置</li>
<li>对应的宿主机上的挂载卷是docker自己指定的（对应存储卷的第二种类型）</li>
</ol>
<h5 id="EXPOSE"><a href="#EXPOSE" class="headerlink" title="EXPOSE"></a>EXPOSE</h5><ol>
<li>定义对外（宿主机）暴露的端口</li>
<li>run的时候直接-P（注意是大写P），docker会自动分配宿主机上的一个端口映射到容器暴露的端口</li>
<li>如果需要自己指定端口映射，运行时使用-p 3306:3306 （小写p）即可</li>
</ol>
<h4 id="tip-linux环境变量-arg跟env命令可能会用到"><a href="#tip-linux环境变量-arg跟env命令可能会用到" class="headerlink" title="tip:linux环境变量(arg跟env命令可能会用到)"></a>tip:linux环境变量(arg跟env命令可能会用到)</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">wangzeqi@wangzeqideMacBook-Pro dist % echo $&#123;name:-wzq&#125;</span><br><span class="line">wzq</span><br><span class="line">wangzeqi@wangzeqideMacBook-Pro dist % name=zpy</span><br><span class="line">wangzeqi@wangzeqideMacBook-Pro dist % echo $name</span><br><span class="line">zpy</span><br></pre></td></tr></table></figure>
<ul>
<li>“-wzq”如果name为空，那么name=wzq</li>
<li>“+wzq”如果name不为空，那么name=wzq</li>
</ul>
<h3 id="其他"><a href="#其他" class="headerlink" title="其他"></a>其他</h3><ol>
<li>一文教您如何通过 Docker 快速搭建各种测试环境(Mysql, Redis, Elasticsearch, MongoDB) <a href="https://juejin.im/post/5ce531b65188252d215ed8b7" target="_blank" rel="noopener">https://juejin.im/post/5ce531b65188252d215ed8b7</a> </li>
</ol>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2020/03/04/docker/" data-id="ckfouenp100283quqbfaaq6or" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-Kotlin" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2020/01/30/Kotlin/" class="article-date">
  <time datetime="2020-01-30T04:27:48.589Z" itemprop="datePublished">2020-01-30</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2020/01/30/Kotlin/">Kotlin</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h4 id="第一章（入门）"><a href="#第一章（入门）" class="headerlink" title="第一章（入门）"></a>第一章（入门）</h4><h5 id="基础"><a href="#基础" class="headerlink" title="基础"></a>基础</h5><ol>
<li><p>var 可变变量   val 不可变变量</p>
</li>
<li><p>可以不用指定类型，会自动推导  eg:</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> v1: <span class="built_in">Int</span> = <span class="number">10</span></span><br><span class="line"><span class="keyword">var</span> v2 = <span class="number">11</span></span><br><span class="line"><span class="keyword">val</span> v3 = <span class="number">12</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>String 跟 String？是两种不同的类型，String 类型不能为空，String？可以空</p>
</li>
<li><p>强转符号 !!  eg:</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> s1: String = <span class="string">"123"</span></span><br><span class="line"><span class="keyword">var</span> s2: String? = <span class="literal">null</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">main</span><span class="params">(args: <span class="type">Array</span>&lt;<span class="type">String</span>&gt;)</span></span> &#123;</span><br><span class="line">    <span class="comment">//需要强转</span></span><br><span class="line">    s1 = s2!!</span><br><span class="line">    s2 = s1</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>函数声明 fun  xxx(param: type): returnType{ … } eg:</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">printlen</span><span class="params">(str: <span class="type">String</span>)</span></span>: String &#123;</span><br><span class="line">    println(<span class="string">"stringValue: <span class="variable">$str</span>"</span>)</span><br><span class="line">    <span class="keyword">return</span> str</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>kotlin中if else 是一个表达式(有返回值)，不是语句</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">max</span><span class="params">(a: <span class="type">Int</span>, b: <span class="type">Int</span>)</span></span>: <span class="built_in">Int</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">if</span> (a &gt; b) a <span class="keyword">else</span> b</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>kotlin中赋值是语句，不是表达式</p>
</li>
<li><p>字符串模版 -&gt;占位符$    </p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//case 1</span></span><br><span class="line"><span class="keyword">val</span> str = <span class="string">"kotlin"</span></span><br><span class="line">println(<span class="string">"hello,<span class="variable">$str</span>"</span>)</span><br><span class="line"><span class="comment">//case 2 :表达式</span></span><br><span class="line">println(<span class="string">"hello,<span class="subst">$&#123;if(str=="kotlin") "kotlin" else "java"&#125;</span>"</span>)</span><br></pre></td></tr></table></figure>
</li>
<li><p>类定义</p>
<ol>
<li><p>Java vs kotlin</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Person</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Person</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getName</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> name;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>转成kotlin: 值对象-&gt;只包含数据，不包含对数据的操作</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Person</span></span>(<span class="keyword">val</span> name: String)</span><br></pre></td></tr></table></figure>
</li>
<li><p>类属性：</p>
<ul>
<li>声明了属性，就隐式声明了该属性的get跟set</li>
<li>如果是val属性，那么只有get</li>
<li>如果是is开头的属性，get方法也是is开头的</li>
</ul>
</li>
<li><p>自定义类属性的get跟set方法：</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Rectangle</span></span>(<span class="keyword">val</span> height: <span class="built_in">Int</span>, <span class="keyword">val</span> width: <span class="built_in">Int</span>) &#123;</span><br><span class="line">    <span class="comment">//方式1</span></span><br><span class="line">    <span class="keyword">val</span> isSquare: <span class="built_in">Boolean</span></span><br><span class="line">        <span class="keyword">get</span>() &#123;</span><br><span class="line">            <span class="keyword">return</span> height == width</span><br><span class="line">        &#125;</span><br><span class="line">	<span class="comment">//方式2</span></span><br><span class="line">    <span class="keyword">val</span> isRect: <span class="built_in">Boolean</span></span><br><span class="line">        <span class="keyword">get</span>() = height &gt; <span class="number">0</span> &amp;&amp; width &gt; <span class="number">0</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">main</span><span class="params">(args: <span class="type">Array</span>&lt;<span class="type">String</span>&gt;)</span></span> &#123;</span><br><span class="line">    <span class="keyword">val</span> rectangle = Rectangle(<span class="number">10</span>, <span class="number">10</span>)</span><br><span class="line">    println(rectangle.isRect)</span><br><span class="line">    println(rectangle.isSquare)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ol>
</li>
<li><p>包结构</p>
<ol>
<li>kotlin中可以将多个类，多个方法放在一个kt文件中</li>
<li>不同包下使用类的时候跟java一致，不同的是kotlin可以导入方法</li>
</ol>
</li>
<li><p>枚举</p>
<p>java使用enum关键字即可，kotlin需要使用enum class</p>
<ol>
<li><p>java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">enum</span> Gender &#123;</span><br><span class="line">    Man, Woman</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>kotlin</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">enum</span> <span class="class"><span class="keyword">class</span> <span class="title">Gender</span> </span>&#123;</span><br><span class="line">    Man, Woman</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ol>
</li>
<li><p>when</p>
<ol>
<li><p>When 替代switch case;when跟if else一样是个表达式，不是语句</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">enum</span> <span class="class"><span class="keyword">class</span> <span class="title">Gender</span> </span>&#123;</span><br><span class="line">    Man, Woman</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">getGender</span><span class="params">(gender: <span class="type">Gender</span>)</span></span>: String &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">when</span> (gender) &#123;</span><br><span class="line">        Gender.Man -&gt; <span class="string">"男"</span></span><br><span class="line">        Gender.Woman -&gt; <span class="string">"女"</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">main</span><span class="params">(args: <span class="type">Array</span>&lt;<span class="type">String</span>&gt;)</span></span> &#123;</span><br><span class="line">    <span class="keyword">val</span> gender = getGender(Gender.Man)</span><br><span class="line">    println(<span class="string">"性别：<span class="variable">$gender</span>"</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>组合的情况,用逗号隔开</p>
</li>
<li><p>when允许任何对象作为分支条件</p>
</li>
<li><p>when可以不指定参数，分支条件可以为任意的boolean表达式</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">getLevel</span><span class="params">(score: <span class="type">Int</span>)</span></span>  =</span><br><span class="line">    <span class="keyword">when</span> &#123;</span><br><span class="line">        (score <span class="keyword">in</span> <span class="number">0.</span><span class="number">.59</span>) -&gt; <span class="string">"不及格"</span></span><br><span class="line">        (score <span class="keyword">in</span> <span class="number">60.</span><span class="number">.100</span>) -&gt; <span class="string">"及格"</span></span><br><span class="line">        <span class="keyword">else</span> -&gt; <span class="keyword">throw</span> Exception(<span class="string">"分数不正确"</span>)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">main</span><span class="params">(args: <span class="type">Array</span>&lt;<span class="type">String</span>&gt;)</span></span> &#123;</span><br><span class="line">    println(getLevel(<span class="number">10</span>))</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ol>
</li>
<li><p>类的智能转换：java中做类型转换前会使用instanceOf() 方法判断，之后再进行强转，kotlin中使用(a is b)进行判断，并且判断之后a对象自动转换为b类型，不需要强转</p>
</li>
<li><p>while 跟java完全一致</p>
</li>
<li><p>forin替代java中的for循环</p>
<ol>
<li><p>整数遍历</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> (i <span class="keyword">in</span> <span class="number">1.</span><span class="number">.10</span>) &#123;</span><br><span class="line">    println(i)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (i <span class="keyword">in</span> <span class="number">10</span> downTo <span class="number">1</span>) &#123;</span><br><span class="line">    println(i)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (i <span class="keyword">in</span> <span class="number">1.</span><span class="number">.10</span> step <span class="number">2</span>) &#123;</span><br><span class="line">    println(i)</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//不包括11</span></span><br><span class="line"><span class="keyword">for</span> (i <span class="keyword">in</span> <span class="number">1</span> until <span class="number">11</span>) &#123;</span><br><span class="line">    println(i)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>遍历数组</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">val</span> arrayList = arrayListOf&lt;String&gt;(<span class="string">"1"</span>, <span class="string">"2"</span>)</span><br><span class="line"><span class="keyword">for</span> ((index,item) <span class="keyword">in</span> arrayList.withIndex())&#123;</span><br><span class="line">    println(<span class="string">"<span class="variable">$index</span>,<span class="variable">$item</span>"</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>遍历map</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">val</span> hashMap = HashMap&lt;String, String&gt;()</span><br><span class="line">hashMap[<span class="string">"1"</span>] = <span class="string">"123"</span></span><br><span class="line">hashMap[<span class="string">"2"</span>] = <span class="string">"234"</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> ((key,value) <span class="keyword">in</span> hashMap)&#123;</span><br><span class="line">    println(<span class="string">"<span class="variable">$key</span>,<span class="variable">$value</span>"</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ol>
</li>
<li><p>in 跟 ! in</p>
<ol>
<li>是否在范围内，范围可以是数字，字符，也可以是实现了Java.lang.comparable接口的类对象实例</li>
<li>是否在集合内</li>
</ol>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">isNumber</span><span class="params">(c: <span class="type">Char</span>)</span></span> = c <span class="keyword">in</span> <span class="string">'0'</span>..<span class="string">'9'</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">main</span><span class="params">(args: <span class="type">Array</span>&lt;<span class="type">String</span>&gt;)</span></span> &#123;</span><br><span class="line">   	println(isNumber(<span class="string">'0'</span>))</span><br><span class="line">	<span class="comment">//string 实现了Java.lang.comparable</span></span><br><span class="line">    println(<span class="string">"javascript"</span> <span class="keyword">in</span> <span class="string">"java"</span>..<span class="string">"kotlin"</span>)</span><br><span class="line">    </span><br><span class="line">    println(<span class="string">"java"</span> !<span class="keyword">in</span> setOf(<span class="string">"java"</span>, <span class="string">"kotlin"</span>))</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>异常处理</p>
<ol>
<li>跟java 一样用try catch finally</li>
<li>它是表达式</li>
<li>kotlin中函数不需要throws异常</li>
</ol>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">readNumber</span><span class="params">(read: <span class="type">BufferedReader</span>)</span></span>: <span class="built_in">Int</span>? &#123;</span><br><span class="line">    <span class="keyword">val</span> line = read.readLine()</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">try</span> &#123;</span><br><span class="line">        Integer.parseInt(line)</span><br><span class="line">    &#125; <span class="keyword">catch</span> (e: Exception) &#123;</span><br><span class="line">        <span class="literal">null</span></span><br><span class="line">    &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">        read.close()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">main</span><span class="params">(args: <span class="type">Array</span>&lt;<span class="type">String</span>&gt;)</span></span> &#123;</span><br><span class="line">    print(readNumber(BufferedReader(StringReader(<span class="string">"123q"</span>))))</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>以上例子中，如果是java，那么需要throws IOException（ 因为read.close()方法 ），但是在kotlin中不需要</p>
</li>
<li><p>创建集合</p>
<ol>
<li>kotlin没有自己的集合类，跟java公用</li>
<li>kotlin在java的基础上增加了一些语法糖</li>
</ol>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">main</span><span class="params">(args: <span class="type">Array</span>&lt;<span class="type">String</span>&gt;)</span></span> &#123;</span><br><span class="line">    <span class="keyword">val</span> hashSet = hashSetOf(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>)</span><br><span class="line">    <span class="keyword">val</span> hashMap = hashMapOf(<span class="number">1</span> to <span class="string">'1'</span>, <span class="number">2</span> to <span class="string">'2'</span>)</span><br><span class="line">    <span class="keyword">val</span> arrayList = arrayListOf(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>)</span><br><span class="line"></span><br><span class="line">    println(hashSet.javaClass)</span><br><span class="line">    println(hashMap.javaClass)</span><br><span class="line">    println(arrayList.javaClass)</span><br><span class="line"></span><br><span class="line">    println(arrayList.last())</span><br><span class="line">    println(hashSet.max())</span><br><span class="line">    println(hashMap[<span class="number">1</span>])</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//输出</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">java</span>.<span class="title">util</span>.<span class="title">HashSet</span></span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">java</span>.<span class="title">util</span>.<span class="title">HashMap</span></span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">java</span>.<span class="title">util</span>.<span class="title">ArrayList</span></span></span><br><span class="line"><span class="number">3</span></span><br><span class="line"><span class="number">3</span></span><br><span class="line"><span class="number">1</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>函数声明时候的默认参数</p>
<ol>
<li>在java的类中会出现大量的方法重载，kotlin的函数参数可以有默认值，这个特性可以减少很多模版化的重载</li>
<li>kotlin调用方法的时候可以指定参数名称，而且可以不用按方法声明的参数顺序去写，增加了代码易读性。</li>
<li>因为java中不具有该特性，java调用该代码的时候必须指定全部参数；@JvmOverloads注解可以让这个方法生成对应的java重载方法，这样就java调用的时候就不用指定全部参数了。</li>
</ol>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@JvmOverloads</span></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">doSomething</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">    param1: <span class="type">String</span>,</span></span></span><br><span class="line"><span class="function"><span class="params">    param2: <span class="type">String</span> = <span class="string">"default"</span></span></span></span><br><span class="line"><span class="function"><span class="params">)</span></span> &#123;</span><br><span class="line">    println(param1)</span><br><span class="line">    println(param2)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">main</span><span class="params">(args: <span class="type">Array</span>&lt;<span class="type">String</span>&gt;)</span></span> &#123;</span><br><span class="line">    doSomething(<span class="string">"1"</span>)</span><br><span class="line">    doSomething(<span class="string">"1"</span>, param2 = <span class="string">"2"</span>)</span><br><span class="line">    doSomething(param2 = <span class="string">"1"</span>, param1 = <span class="string">"2"</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ol>
<h5 id="kotlin跟java可以随便调用吗"><a href="#kotlin跟java可以随便调用吗" class="headerlink" title="kotlin跟java可以随便调用吗"></a>kotlin跟java可以随便调用吗</h5><ol>
<li><p>kotlin可以直接在.kt文件中写变量写方法等。</p>
<p>Test.kt文件如下</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> v1: <span class="built_in">Int</span> = <span class="number">10</span></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">printlen</span><span class="params">(str: <span class="type">String</span>)</span></span>: String &#123;</span><br><span class="line">    println(<span class="string">"stringValue: <span class="variable">$str</span>"</span>)</span><br><span class="line">    <span class="keyword">return</span> str</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>java中调用（文件名+Kt是编译之后的class名，getV1跟setV1是编译过程中自动生成的）</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//调用方法</span></span><br><span class="line">TestKt.printlen(<span class="string">"111"</span>);</span><br><span class="line"><span class="comment">//使用变量</span></span><br><span class="line">TestKt.getV1();</span><br><span class="line">TestKt.setV1(<span class="number">2</span>);</span><br></pre></td></tr></table></figure>
</li>
</ol>
<ol start="2">
<li><p>kotlin匿名内部类 ，关键字object+类名{ xxx } </p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Kt</span> </span>&#123;</span><br><span class="line">    <span class="comment">//定义匿名内部类</span></span><br><span class="line">    <span class="keyword">object</span> Inner&#123;</span><br><span class="line">        <span class="function"><span class="keyword">fun</span> <span class="title">sayHello</span><span class="params">()</span></span>&#123;</span><br><span class="line">            println(<span class="string">"hello"</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">fun</span> <span class="title">test</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="comment">//kotlin 调用</span></span><br><span class="line">        Inner.sayHello()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> void test()&#123;</span><br><span class="line">    <span class="comment">//java调用</span></span><br><span class="line">    Kt.Inner.INSTANCE.sayHello();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>从java的调用方式可以看出来匿名内部类是单例的。</p>
</li>
</ol>
<ol start="3">
<li><p>kotlin使用java中Class对象，kotlin中Class是KClass</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//J是一个java类</span></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">test</span><span class="params">(clazz: <span class="type">Class</span>&lt;<span class="type">J</span>&gt;)</span></span> &#123;</span><br><span class="line">    println(clazz.simpleName)</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//Kt是一个kotlin类</span></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">test1</span><span class="params">(clazz: <span class="type">KClass</span>&lt;<span class="type">Kt</span>&gt;)</span></span>&#123;</span><br><span class="line">    println(clazz.simpleName)</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//调用</span></span><br><span class="line">test(J::<span class="class"><span class="keyword">class</span>.<span class="title">java</span>)</span></span><br><span class="line">test1(Kt::<span class="class"><span class="keyword">class</span>)</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>in在kotlin中是关键字，如果调用的java常量名字是in需要加<code></code></p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">J.<span class="string">'in'</span></span><br></pre></td></tr></table></figure>
</li>
</ol>
<h5 id="新手常见问题"><a href="#新手常见问题" class="headerlink" title="新手常见问题"></a>新手常见问题</h5><ol>
<li>kotlin中默认的只有基础类型，没有封装类型</li>
<li>kotlin是空安全的，调用返回值是String的java方法时需要用String?来接受返回值，不能用var。var接受的话会自动推导成String！，如果用var接受，当方法返回值是null的时候，可能会有空安全问题（比如调用.length()）。</li>
<li><p>kotlin中没有静态变量跟静态方法</p>
<p> ​    </p>
</li>
</ol>
<h4 id="第二章-函数跟lambda闭包"><a href="#第二章-函数跟lambda闭包" class="headerlink" title="第二章  函数跟lambda闭包"></a>第二章  函数跟lambda闭包</h4><h5 id="函数特性"><a href="#函数特性" class="headerlink" title="函数特性"></a>函数特性</h5><ol>
<li><p>函数参数可以有默认值</p>
</li>
<li><p>如果只有一个语句可以如下</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">test</span><span class="params">()</span></span> = print(<span class="string">"hello"</span>)</span><br></pre></td></tr></table></figure>
</li>
</ol>
<h5 id="嵌套函数"><a href="#嵌套函数" class="headerlink" title="嵌套函数"></a>嵌套函数</h5><p>函数中可以声明函数</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">test3</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">var</span> count =<span class="number">3</span></span><br><span class="line">    <span class="function"><span class="keyword">fun</span> <span class="title">say</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(count &gt;<span class="number">0</span>)&#123;</span><br><span class="line">            println(<span class="string">"hello"</span>)</span><br><span class="line">            count--</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    say()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="扩展函数"><a href="#扩展函数" class="headerlink" title="扩展函数"></a>扩展函数</h5><ol>
<li><p>语法</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//扩展java中的File，注意this</span></span><br><span class="line"><span class="function"><span class="keyword">fun</span> File.<span class="title">printFileName</span><span class="params">()</span></span> = print(<span class="keyword">this</span>.name)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">val</span> file = File(<span class="string">"./kotlin_study.iml"</span>)</span><br><span class="line">    file.printFileName()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>使用场景</p>
<ul>
<li>用于扩展第三方的类</li>
<li>用于扩展java的类</li>
<li>。。。感觉就是很强大</li>
</ul>
</li>
<li><p>注意点</p>
<ul>
<li>扩展函数都是静态的（public static final）</li>
<li>不具有重载的特性（看上去是对象在调用，实际是类在调用）</li>
</ul>
</li>
</ol>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2020/01/30/Kotlin/" data-id="ckfouenpd002n3quq7dlbeiqg" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Kotlin/">Kotlin</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-设计模式--策略-观察者-装饰" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2020/01/21/设计模式--策略-观察者-装饰/" class="article-date">
  <time datetime="2020-01-21T09:25:51.194Z" itemprop="datePublished">2020-01-21</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2020/01/21/设计模式--策略-观察者-装饰/">设计模式--策略 观察者 装饰</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h5 id="策略模式"><a href="#策略模式" class="headerlink" title="策略模式"></a>策略模式</h5><h6 id="场景"><a href="#场景" class="headerlink" title="场景"></a>场景</h6><p>算法簇：不同级别的用户，支付级别不同。</p>
<h6 id="设计"><a href="#设计" class="headerlink" title="设计"></a>设计</h6><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">interface</span> <span class="title">IPay</span></span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">pay</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span>  <span class="title">VipPay</span> <span class="keyword">implements</span> <span class="title">IPay</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span>  <span class="title">CustomPay</span> <span class="keyword">implements</span> <span class="title">IPay</span></span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">class User:&#123;</span><br><span class="line"></span><br><span class="line">	IPay pay;</span><br><span class="line">	</span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">setPay</span><span class="params">(IPay pay)</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">pay</span><span class="params">()</span></span>&#123;</span><br><span class="line"></span><br><span class="line">		pay.pay();</span><br><span class="line"></span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h6 id="角色"><a href="#角色" class="headerlink" title="角色"></a>角色</h6><ol>
<li>策略接口</li>
<li>策略实现</li>
<li>使用策略的上下文（对应上面例子例子中有需要支付功能的用户）</li>
</ol>
<h5 id="观察者模式"><a href="#观察者模式" class="headerlink" title="观察者模式"></a>观察者模式</h5><h6 id="场景-1"><a href="#场景-1" class="headerlink" title="场景"></a>场景</h6><p>订阅场景：粉丝时刻关注明星的动态。</p>
<h6 id="设计-1"><a href="#设计-1" class="headerlink" title="设计"></a>设计</h6><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Subject</span></span>&#123;  <span class="comment">// 明星</span></span><br><span class="line">	ArrayList&lt;Observer&gt; observers;</span><br><span class="line">    </span><br><span class="line">    regist(Observer o);</span><br><span class="line">    unregist(Observer o);</span><br><span class="line">    notifyAll(Message msg)&#123;</span><br><span class="line">        <span class="keyword">for</span> each : observers</span><br><span class="line">        	observer.onChange(msg);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">interface</span> <span class="title">Observer</span></span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">onChange</span><span class="params">(Message msg)</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">fan1</span> <span class="keyword">implements</span> <span class="title">Observer</span></span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">onChange</span><span class="params">(Message msg)</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">fan2</span> <span class="keyword">implements</span> <span class="title">Observer</span></span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">onChange</span><span class="params">(Message msg)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h6 id="角色-1"><a href="#角色-1" class="headerlink" title="角色"></a>角色</h6><p>被观察者：subject</p>
<p>观察者：（接口以及实现）</p>
<h5 id="装饰者模式"><a href="#装饰者模式" class="headerlink" title="装饰者模式"></a>装饰者模式</h5><h6 id="场景-2"><a href="#场景-2" class="headerlink" title="场景"></a>场景</h6><p>不用继承扩展原有类的功能：男生-&gt;有车的男生-&gt; 有房子的男生。。。</p>
<p>java I/0流：</p>
<ul>
<li>InputStream（实体基类）  </li>
<li>FileInputStream（实体的实现）    </li>
<li>FilterInputStream（装饰器基类）  </li>
<li>BufferedInputStream（装饰器实现）</li>
</ul>
<h6 id="设计-2"><a href="#设计-2" class="headerlink" title="设计"></a>设计</h6><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">interface</span> <span class="title">Man</span></span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">getDec</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">NormalMan</span> <span class="keyword">implements</span> <span class="title">Man</span></span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">getDec</span><span class="params">()</span></span>&#123;</span><br><span class="line">        print <span class="string">"normal man"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Decorator</span> <span class="keyword">implements</span> <span class="title">Man</span></span>&#123;</span><br><span class="line">    Man man;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">ManDecorator</span><span class="params">(Man man)</span></span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.man=man;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">getDec</span><span class="params">()</span></span>&#123;</span><br><span class="line">        man.getDec();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">CarDecorator</span> <span class="keyword">extends</span> <span class="title">Decorator</span></span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">CarDecorator</span><span class="params">(Man man)</span></span>&#123;</span><br><span class="line">        <span class="keyword">super</span>(man);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">getDec</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.getDec();</span><br><span class="line">        print <span class="string">"have car"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">HouseDecorator</span> <span class="keyword">extends</span> <span class="title">Decorator</span></span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">CarDecorator</span><span class="params">(Man man)</span></span>&#123;</span><br><span class="line">        <span class="keyword">super</span>(man);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">getDec</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.getDec();</span><br><span class="line">        print <span class="string">"have house"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">使用：</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span></span>&#123;</span><br><span class="line">	Man man = <span class="keyword">new</span> NormalMan();</span><br><span class="line">	<span class="comment">//车子装饰</span></span><br><span class="line">	Man man1 = <span class="keyword">new</span> CarDecorator(man);</span><br><span class="line">	<span class="comment">//房子装饰</span></span><br><span class="line">	Man man2 = <span class="keyword">new</span> HouseDecorator(man1);</span><br><span class="line">	</span><br><span class="line">	man2.getDec();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h6 id="角色-2"><a href="#角色-2" class="headerlink" title="角色"></a>角色</h6><ol>
<li>实体的基类：对应man</li>
<li>实体的实现：对应normalMan</li>
<li>装饰器的基类（实现了实体基类）：对应decorator</li>
<li>装饰器的实现：对应CarDecorator.    HouseDecorator;</li>
</ol>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2020/01/21/设计模式--策略-观察者-装饰/" data-id="ckfouenr7004p3quqqbsmhy6v" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/设计模式/">设计模式</a></li></ul>

    </footer>
  </div>
  
</article>


  


  <nav id="page-nav">
    
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="page-number" href="/page/3/">3</a><span class="space">&hellip;</span><a class="page-number" href="/page/10/">10</a><a class="extend next" rel="next" href="/page/2/">Next &raquo;</a>
  </nav>

</section>
        
          <aside id="sidebar">
  
    

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/tags/Andoird-反编译-讯飞/">Andoird 反编译 讯飞</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Andoird-第三方登录/">Andoird 第三方登录</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Android/">Android</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Android-tensorFlow/">Android  tensorFlow</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Android-openCV/">Android openCV</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Android-recycleView-itemDecoration/">Android recycleView itemDecoration</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Android-recycleView-瀑布流/">Android recycleView 瀑布流</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Android-recyclerView/">Android recyclerView</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Android-sdk/">Android sdk</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Android-反编译/">Android 反编译</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Android-反编译-smali-讯飞/">Android 反编译 smali 讯飞</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Android-基础/">Android 基础</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Android-安全/">Android 安全</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Android-微信小程序/">Android 微信小程序</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Android-懒加载/">Android 懒加载</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Android-数据库/">Android 数据库</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Android-架构/">Android 架构</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Android-自定义View/">Android 自定义View</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Android-通信-eventBus/">Android 通信 eventBus</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Android-音频/">Android 音频</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/JVM/">JVM</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Kotlin/">Kotlin</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Mysql/">Mysql</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/android/">android</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/android-gradle/">android gradle</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/android-net/">android net</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/android-permission/">android permission</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/android-ui/">android ui</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/android-内存优化/">android 内存优化</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/android-混合开发/">android 混合开发</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/android-源码/">android 源码</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/android-音视频/">android 音视频</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/jvm/">jvm</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/kotlin/">kotlin</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/leetcode/">leetcode</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/leetcode-dp/">leetcode dp</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/leetcode-dp-01背包/">leetcode dp 01背包</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/leetcode-stack/">leetcode stack</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/net/">net</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/python-爬虫/">python 爬虫</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/server-test-api/">server test-api</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/svg-java/">svg java</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/vue/">vue</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/后端-springBoot/">后端 springBoot</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/性能优化/">性能优化</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/数据结构/">数据结构</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/混合开发-webView/">混合开发 webView</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/算法/">算法</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/网络，安全/">网络，安全</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/设计模式/">设计模式</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/音视频/">音视频</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="/tags/Andoird-反编译-讯飞/" style="font-size: 10px;">Andoird 反编译 讯飞</a> <a href="/tags/Andoird-第三方登录/" style="font-size: 10px;">Andoird 第三方登录</a> <a href="/tags/Android/" style="font-size: 12.5px;">Android</a> <a href="/tags/Android-tensorFlow/" style="font-size: 10px;">Android  tensorFlow</a> <a href="/tags/Android-openCV/" style="font-size: 10px;">Android openCV</a> <a href="/tags/Android-recycleView-itemDecoration/" style="font-size: 10px;">Android recycleView itemDecoration</a> <a href="/tags/Android-recycleView-瀑布流/" style="font-size: 10px;">Android recycleView 瀑布流</a> <a href="/tags/Android-recyclerView/" style="font-size: 10px;">Android recyclerView</a> <a href="/tags/Android-sdk/" style="font-size: 10px;">Android sdk</a> <a href="/tags/Android-反编译/" style="font-size: 10px;">Android 反编译</a> <a href="/tags/Android-反编译-smali-讯飞/" style="font-size: 10px;">Android 反编译 smali 讯飞</a> <a href="/tags/Android-基础/" style="font-size: 10px;">Android 基础</a> <a href="/tags/Android-安全/" style="font-size: 10px;">Android 安全</a> <a href="/tags/Android-微信小程序/" style="font-size: 10px;">Android 微信小程序</a> <a href="/tags/Android-懒加载/" style="font-size: 10px;">Android 懒加载</a> <a href="/tags/Android-数据库/" style="font-size: 10px;">Android 数据库</a> <a href="/tags/Android-架构/" style="font-size: 10px;">Android 架构</a> <a href="/tags/Android-自定义View/" style="font-size: 10px;">Android 自定义View</a> <a href="/tags/Android-通信-eventBus/" style="font-size: 10px;">Android 通信 eventBus</a> <a href="/tags/Android-音频/" style="font-size: 10px;">Android 音频</a> <a href="/tags/JVM/" style="font-size: 17.5px;">JVM</a> <a href="/tags/Kotlin/" style="font-size: 10px;">Kotlin</a> <a href="/tags/Mysql/" style="font-size: 10px;">Mysql</a> <a href="/tags/android/" style="font-size: 15px;">android</a> <a href="/tags/android-gradle/" style="font-size: 10px;">android gradle</a> <a href="/tags/android-net/" style="font-size: 10px;">android net</a> <a href="/tags/android-permission/" style="font-size: 10px;">android permission</a> <a href="/tags/android-ui/" style="font-size: 10px;">android ui</a> <a href="/tags/android-内存优化/" style="font-size: 10px;">android 内存优化</a> <a href="/tags/android-混合开发/" style="font-size: 10px;">android 混合开发</a> <a href="/tags/android-源码/" style="font-size: 10px;">android 源码</a> <a href="/tags/android-音视频/" style="font-size: 10px;">android 音视频</a> <a href="/tags/jvm/" style="font-size: 17.5px;">jvm</a> <a href="/tags/kotlin/" style="font-size: 10px;">kotlin</a> <a href="/tags/leetcode/" style="font-size: 12.5px;">leetcode</a> <a href="/tags/leetcode-dp/" style="font-size: 20px;">leetcode dp</a> <a href="/tags/leetcode-dp-01背包/" style="font-size: 10px;">leetcode dp 01背包</a> <a href="/tags/leetcode-stack/" style="font-size: 12.5px;">leetcode stack</a> <a href="/tags/net/" style="font-size: 10px;">net</a> <a href="/tags/python-爬虫/" style="font-size: 10px;">python 爬虫</a> <a href="/tags/server-test-api/" style="font-size: 10px;">server test-api</a> <a href="/tags/svg-java/" style="font-size: 10px;">svg java</a> <a href="/tags/vue/" style="font-size: 10px;">vue</a> <a href="/tags/后端-springBoot/" style="font-size: 10px;">后端 springBoot</a> <a href="/tags/性能优化/" style="font-size: 10px;">性能优化</a> <a href="/tags/数据结构/" style="font-size: 12.5px;">数据结构</a> <a href="/tags/混合开发-webView/" style="font-size: 10px;">混合开发 webView</a> <a href="/tags/算法/" style="font-size: 10px;">算法</a> <a href="/tags/网络，安全/" style="font-size: 10px;">网络，安全</a> <a href="/tags/设计模式/" style="font-size: 12.5px;">设计模式</a> <a href="/tags/音视频/" style="font-size: 15px;">音视频</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/06/">June 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/03/">March 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/01/">January 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/12/">December 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/09/">September 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/08/">August 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/07/">July 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/06/">June 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/05/">May 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/04/">April 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/03/">March 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/02/">February 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/01/">January 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/12/">December 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/11/">November 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/10/">October 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/09/">September 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/08/">August 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/07/">July 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/06/">June 2018</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2020/06/09/kotlin-基础/">kotlin基础</a>
          </li>
        
          <li>
            <a href="/2020/03/19/后台开发/">后台开发</a>
          </li>
        
          <li>
            <a href="/2020/03/18/mysql添加索引解决速度问题/">Mysql添加索引解决速度问题</a>
          </li>
        
          <li>
            <a href="/2020/03/13/oss/">oss</a>
          </li>
        
          <li>
            <a href="/2020/03/10/python解析html/">python解析html</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2020 kb_jay<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/script.js"></script>



  </div>
</body>
</html>